

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7. Multi-Tenancy with Stormpath &mdash; Stormpath 0.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  
    <link rel="top" title="Stormpath 0.0.1 documentation" href="index.html"/>
        <link rel="next" title="8. Using ID Site" href="008_idsite.html"/>
        <link rel="prev" title="6. Authorization With Stormpath" href="006_auth_z.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Stormpath</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="001_about.html">1. About Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="001_about.html#what-is-stormpath">What is Stormpath?</a></li>
<li class="toctree-l2"><a class="reference internal" href="001_about.html#the-stormpath-data-model">The Stormpath Data Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="002_setup.html">2. First-Time Set-Up</a><ul>
<li class="toctree-l2"><a class="reference internal" href="002_setup.html#a-sign-up-for-stormpath">a. Sign-up for Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="002_setup.html#b-create-an-api-key-pair">b. Create an API Key Pair</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="003_quickstart.html">3. Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="003_quickstart.html#retrieve-your-application">Retrieve your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="003_quickstart.html#create-a-user-account">Create a User Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="003_quickstart.html#authenticate-a-user-account">Authenticate a User Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="003_quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="004_accnt_mgmt.html">4. Account Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="004_accnt_mgmt.html#a-modeling-your-user-base">a. Modeling Your User Base</a></li>
<li class="toctree-l2"><a class="reference internal" href="004_accnt_mgmt.html#b-how-to-store-accounts-in-stormpath">b. How to Store Accounts in Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="004_accnt_mgmt.html#c-how-to-search-accounts">c. How to Search Accounts</a></li>
<li class="toctree-l2"><a class="reference internal" href="004_accnt_mgmt.html#d-how-to-manage-an-account-s-password">d. How to Manage an Account&#8217;s Password</a></li>
<li class="toctree-l2"><a class="reference internal" href="004_accnt_mgmt.html#e-how-to-verify-an-account-s-email">e. How to Verify an Account&#8217;s Email</a></li>
<li class="toctree-l2"><a class="reference internal" href="004_accnt_mgmt.html#f-customizing-stormpath-emails-via-rest">f. Customizing Stormpath Emails via REST</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="005_auth_n.html">5. Authenticating Accounts with Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="005_auth_n.html#a-how-password-authentication-works-in-stormpath">a. How Password Authentication Works in Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="005_auth_n.html#b-how-token-based-authentication-works">b. How Token-Based Authentication Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="005_auth_n.html#c-how-social-authentication-works">c. How Social Authentication Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="005_auth_n.html#d-authenticating-against-a-mirrored-ldap-directory">d. Authenticating Against a Mirrored LDAP Directory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="006_auth_z.html">6. Authorization With Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="006_auth_z.html#a-what-is-authorization">a. What is Authorization?</a></li>
<li class="toctree-l2"><a class="reference internal" href="006_auth_z.html#b-modeling-authorization-in-stormpath">b. Modeling Authorization in Stormpath</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">7. Multi-Tenancy with Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#a-what-is-a-multi-tenant-application">a. What Is a Multi-Tenant Application?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#b-modeling-tenants-in-stormpath">b. Modeling Tenants in Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="#c-authenticating-an-account-against-an-organization">c. Authenticating an Account against an Organization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="008_idsite.html">8. Using ID Site</a><ul>
<li class="toctree-l2"><a class="reference internal" href="008_idsite.html#a-what-is-an-id-site">a. What is an ID Site?</a></li>
<li class="toctree-l2"><a class="reference internal" href="008_idsite.html#b-how-does-id-site-work">b. How does ID Site Work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="008_idsite.html#c-id-site-set-up">c. ID Site Set Up</a></li>
<li class="toctree-l2"><a class="reference internal" href="008_idsite.html#using-id-site-without-an-sdk">Using ID Site Without an SDK</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">REST API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference.html#rest-api-core-concepts">REST API Core Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#tenant">Tenant</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#application">Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#account-store-mapping">Account Store Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#directory">Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#group">Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#group-membership">Group Membership</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#organization">Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#account">Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html#custom-data">Custom Data</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Stormpath</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>7. Multi-Tenancy with Stormpath</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/007_multitenancy.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="multi-tenancy-with-stormpath">
<span id="multitenancy"></span><h1>7. Multi-Tenancy with Stormpath<a class="headerlink" href="#multi-tenancy-with-stormpath" title="Permalink to this headline">¶</a></h1>
<div class="section" id="a-what-is-a-multi-tenant-application">
<h2>a. What Is a Multi-Tenant Application?<a class="headerlink" href="#a-what-is-a-multi-tenant-application" title="Permalink to this headline">¶</a></h2>
<p>The best way to understand the concept of multi-tenancy is by thinking of a condo: lots of residents making use of a shared infrastructure while maintaining their own private and secure living areas. Similar to this, a <strong>multi-tenant application</strong> is a single application that services multiple tenants simultaneously. For privacy and security purposes, it&#8217;s very important that the application maintain data segmentation between its multiple tenants. At Stormpath, this segmentation is baked-in to our data model. How do we do this? Well, it starts with an Organization.</p>
</div>
<div class="section" id="b-modeling-tenants-in-stormpath">
<h2>b. Modeling Tenants in Stormpath<a class="headerlink" href="#b-modeling-tenants-in-stormpath" title="Permalink to this headline">¶</a></h2>
<p>In our <a class="reference internal" href="004_accnt_mgmt.html#account-mgmt"><span>Account Management</span></a> chapter we discussed two kinds of Account Stores: <a class="reference internal" href="004_accnt_mgmt.html#directory-mgmt"><span>Directories</span></a>, and <a class="reference internal" href="004_accnt_mgmt.html#group-mgmt"><span>Groups</span></a>. For multi-tenant applications there is an additional <a class="reference internal" href="reference.html#ref-organization"><span>Organization</span></a> resource, which functions like a virtual Account Store that itself wraps both Directories and Groups.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A Directory or Group can be added to multiple Organizations.</p>
</div>
<div class="section" id="organizations">
<h3>Organizations<a class="headerlink" href="#organizations" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="reference.html#ref-organization"><span>Organization</span></a> resource is not to be confused with the Tenant resource. While the <a class="reference internal" href="reference.html#ref-tenant"><span>Tenant</span></a> resource is so-called because it represents your tenancy inside the Stormpath server, the Organization resource represents the space alloted for a tenant of your application.</p>
<p>The Organization resource allows your application&#8217;s tenants to have as many, or as few, Directories and Groups as they want, while also maintaining strict data segregation. So if a tenant requires a Cloud Directory, a Google Social Directory, and an LDAP Directory, then all of these can sit under the umbrella of a single Organization resource that represents their data space in your app.</p>
<div class="section" id="how-to-create-an-organization">
<h4>How to Create an Organization<a class="headerlink" href="#how-to-create-an-organization" title="Permalink to this headline">¶</a></h4>
<p>You can create an Organization in Stormpath by simply performing an HTTP POST to the <code class="docutils literal"><span class="pre">/v1/organizations</span></code> endpoint.</p>
<p>So, if for example one of our application&#8217;s tenants was the Royal Bank of Canada, we could send the following POST:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/organizations</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Royal Bank of Canada&quot;</span><span class="p">,</span>
  <span class="nt">&quot;nameKey&quot;</span><span class="p">:</span> <span class="s2">&quot;rbc&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Which would return the following:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-10-02T15:27:01.658Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-10-02T15:27:01.658Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Royal Bank of Canada&quot;</span><span class="p">,</span>
  <span class="nt">&quot;nameKey&quot;</span><span class="p">:</span> <span class="s2">&quot;rbc&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;customData&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE/customData&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;defaultAccountStoreMapping&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;defaultGroupStoreMapping&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;accountStoreMappings&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE/accountStoreMappings&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;groups&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE/groups&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE/accounts&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;tenant&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/tenants/1gBTncWsp2ObQGgDn9R91R&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notice here that both the Default Account Store and Group Store are blank which means that Groups and Accounts added to the Organization (e.g. A POST to <code class="docutils literal"><span class="pre">/v1/organizations/$ORGANIZATION_ID/groups</span></code>) would fail until a default Account Store is added.</p>
</div>
<div class="section" id="adding-an-account-store-to-an-organization">
<h4>Adding an Account Store to an Organization<a class="headerlink" href="#adding-an-account-store-to-an-organization" title="Permalink to this headline">¶</a></h4>
<p>Like other Account Stores, an Organization can be mapped to an Application so that users in the Organization can log-in to that application (for more about how logging-in works with Stormpath, please see <a class="reference internal" href="005_auth_n.html#authn"><span>the Authentication chapter</span></a>). But before you do this, you must first associate some users with the Organization so that there is someone to log in! To do this, you have to map some Account Stores to your Organization.</p>
<p>First, you will need the <code class="docutils literal"><span class="pre">href</span></code> value for a Directory or Group. This, combined with the <code class="docutils literal"><span class="pre">href</span></code> of the Organization will be sent in a POST:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/organizations</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;organization&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accountStore&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/directories/2jw4Kslj97zYjYREXaMPLe&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These two attributes, <code class="docutils literal"><span class="pre">organization</span></code> and <code class="docutils literal"><span class="pre">accountStore</span></code> are required, though you may add some optional attributes as well:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">listIndex</span></code>: Represents the priority in whicch this accountStore will be consulted by the Organization during an authentication attempt. This is a zero-based index, meaning that an Account Store at <code class="docutils literal"><span class="pre">listIndex</span></code> of 0 will be consulted first, followed by the Account Store at listIndex 1, etc. Setting a negative value will default the value to 0, placing it first in the list. A listIndex of larger than the current list size will place the mapping at the end of the list and then default the value to (list size – 1).</li>
<li><code class="docutils literal"><span class="pre">isDefaultAccountStore</span></code>: A <code class="docutils literal"><span class="pre">true</span></code> value indicates that new Accounts created by the Organization’s <code class="docutils literal"><span class="pre">/accounts</span></code> endpoint will be automatically saved to this mapping’s Directory or Group.</li>
<li><code class="docutils literal"><span class="pre">isDefaultGroupStore</span></code>: A <code class="docutils literal"><span class="pre">true</span></code> value indicates that new Groups created by the Organization’s <code class="docutils literal"><span class="pre">/groups</span></code> endpoint will be automatically saved to this mapping’s Directory. Note that a <code class="docutils literal"><span class="pre">true</span></code> value will only be valid here if the accountStore is a Directory.</li>
</ul>
<p>In order to be able to add Groups and Accounts to the Organization in the way mentioned above, we should also make sure that we mark this Account Store as our default for both Accounts and Groups:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/organizations</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;organization&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accountStore&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/directories/2jw4Kslj97zYjYREXaMPLe&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;isDefaultAccountStore&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;isDefaultGroupStore&quot;</span><span class="p">:</span><span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Which would result in the following <code class="docutils literal"><span class="pre">201</span> <span class="pre">Created</span></code> response:</p>
<div class="highlight-http"><div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/organizationAccountStoreMappings/3e9cNxhX8abxmPWexAMPle&quot;</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizationAccountStoreMappings/3e9cNxhX8abxmPWexAMPle&quot;</span><span class="p">,</span>
  <span class="nt">&quot;listIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;isDefaultAccountStore&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;isDefaultGroupStore&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;organization&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accountStore&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/directories/7Fg2qiGIv8vEjTKHddd0mT&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>So our Organization now has an associated Directory which can be used as an Account Store to add new Accounts and Groups. To enable login for the Accounts in this Organization, we must now map the Organization to an Application.</p>
</div>
<div class="section" id="registering-an-organization-as-an-account-store-for-an-application">
<h4>Registering an Organization as an Account Store for an Application<a class="headerlink" href="#registering-an-organization-as-an-account-store-for-an-application" title="Permalink to this headline">¶</a></h4>
<p>As described in <a class="reference internal" href="005_auth_n.html#authn"><span>the Authentication chapter</span></a>, in order to allow users to log-in to an Application, you must map some kind of Account Store (e.g. a Group or Directory) to it. One approach is to go one-by-one and map each Directory and/or Group to the Application. However, since we are building a multi-tenant app, and the Organization is itself an Account Store, we can just map our Organization resource to our Application resource. This would enable login for all of the Directories and Groups currently inside that Organization, as well as any we add in the future.</p>
<p>To map an Organization to an Application, simply follow the steps you would for any Account Store, as described in <a class="reference internal" href="005_auth_n.html#create-asm"><span>Mapping a new Account Store</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="c-authenticating-an-account-against-an-organization">
<h2>c. Authenticating an Account against an Organization<a class="headerlink" href="#c-authenticating-an-account-against-an-organization" title="Permalink to this headline">¶</a></h2>
<p>Authenticating an Account against an Organization works essentially the same way as described in <a class="reference internal" href="005_auth_n.html#how-login-works"><span>How Login Attempts Work in Stormpath</span></a>. The only difference is that adding the Organization resource allows for an additional level of Account Stores.</p>
<p>When a login attempt is made against an Application’s <code class="docutils literal"><span class="pre">/loginAttempts</span></code> endpoint without specifying an Account Store, Stormpath will iterate through the index of Account Stores mapped to the Application, in priority order. For every Account Store entry:</p>
<ul class="simple">
<li>If it is a Directory or Group, attempt to log in on that resource.</li>
<li>If it is an Organization:<ul>
<li>Iterate through the index of Account Stores mapped to the Organization, in priority order. For every Account Store entry:<ul>
<li>If it is a Directory or Group, attempt to log in on that resource.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>If the login attempt does specify an Organization, then we simply jump to that point in the steps, and the Organization&#8217;s Account Stores are iterated through as described above.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="008_idsite.html" class="btn btn-neutral float-right" title="8. Using ID Site">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="006_auth_z.html" class="btn btn-neutral" title="6. Authorization With Stormpath"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Stormpath, Inc..
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>