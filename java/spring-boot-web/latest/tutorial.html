

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial &mdash; Spring Boot Stormpath Web Starter 1.0.RC5.2 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="Spring Boot Stormpath Web Starter 1.0.RC5.2 documentation" href="index.html"/>
        <link rel="next" title="Configuration" href="config.html"/>
        <link rel="prev" title="Quickstart" href="quickstart.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Spring Boot Stormpath Web Starter</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#what-is-stormpath">What is Stormpath?</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#what-is-the-project">What is the Spring Boot Stormpath Web Starter?</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#who-should-use-stormpath">Who should use Stormpath?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#get-an-api-key">Get an API Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#add-the-stormpath-default-spring-boot-starter">Add the Stormpath Default Spring Boot Starter</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#try-it">Try it!</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#get-an-api-key">Get an API Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spring-boot-meet-stormpath">Spring Boot: Meet Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="#some-access-controls">Some Access Controls</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spring-security-meet-stormpath">Spring Security: Meet Stormpath</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spring-security-refined">Spring Security Refined</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-finer-grain-of-control">A Finer Grain of Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-spring-security-integration">Advanced Spring Security Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wrapping-up">Wrapping Up</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="config.html#no-config">No Config?</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#property-overrides">Property Overrides</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#bean-overrides">Bean Overrides</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#stormpath-client">Stormpath Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#stormpath-application">Stormpath Application</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="registration.html">Registration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="registration.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#uri">URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#next-uri">Next URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#view">View</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#i18n">i18n</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#email-verification">Email Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#events">Events</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="login.html">Login</a><ul>
<li class="toctree-l2"><a class="reference internal" href="login.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#security-notice">Security Notice</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#uri">URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#next-uri">Next URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#view">View</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#i18n">i18n</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#events">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="login.html#authentication-state">Authentication State</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="forgot-password.html">Forgot Password</a><ul>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#configure-the-workflow">Configure the Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#try-it">Try it!</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#forgot-uri">Forgot URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#forgot-next-uri">Forgot Next URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#forgot-view">Forgot View</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#change-password-uri">Change Password URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#change-password-next-uri">Change Password Next URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#change-password-view">Change Password View</a></li>
<li class="toctree-l2"><a class="reference internal" href="forgot-password.html#i18n">i18n</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="logout.html">Logout</a><ul>
<li class="toctree-l2"><a class="reference internal" href="logout.html#uri">URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="logout.html#next-uri">Next URI</a></li>
<li class="toctree-l2"><a class="reference internal" href="logout.html#events">Events</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="http-request-authentication.html">HTTP Request Authentication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="http-request-authentication.html#http-basic-authentication">HTTP Basic Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="http-request-authentication.html#token-authentication">Token Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="http-request-authentication.html#api-key-authentication">API Key Authentication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="request.html">Request Context</a><ul>
<li class="toctree-l2"><a class="reference internal" href="request.html#current-user-account">Current User Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="request.html#stormpath-application">Stormpath Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="request.html#stormpath-sdk-client">Stormpath SDK Client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="i18n.html">Internationalization (i18n)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="i18n.html#languages">Languages</a></li>
<li class="toctree-l2"><a class="reference internal" href="i18n.html#request-locale">Request Locale</a></li>
<li class="toctree-l2"><a class="reference internal" href="i18n.html#view-templates">View Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="i18n.html#i18n-properties">i18n.properties</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events</a><ul>
<li class="toctree-l2"><a class="reference internal" href="events.html#requesteventlistener">RequestEventListener</a></li>
<li class="toctree-l2"><a class="reference internal" href="events.html#id2">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="events.html#listener-best-practices">Listener Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="caching.html">Caching</a><ul>
<li class="toctree-l2"><a class="reference internal" href="caching.html#disable-caching">Disable Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="caching.html#cache-configuration">Cache Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="idsite.html">ID Site</a><ul>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#how-does-it-work">How Does It Work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#enable-id-site">Enable ID Site</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#configure-your-application">Configure Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="idsite.html#try-it">Try It!</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="views.html">Custom Views</a><ul>
<li class="toctree-l2"><a class="reference internal" href="views.html#thymeleaf-views">Thymeleaf Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html#head-template">Head Template</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html#css">CSS</a></li>
<li class="toctree-l2"><a class="reference internal" href="views.html#change-a-default-view">Change a Default View</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix/default-stormpath-properties.html">Default Stormpath Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix/i18n-properties.html">i18n.properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix/stormpath-css.html">/assets/css/stormpath.css</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix/change.html">/templates/stormpath/change.html</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix/forgot.html">/templates/stormpath/forgot.html</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix/head.html">/templates/stormpath/head.html</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix/login.html">/templates/stormpath/login.html</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix/register.html">/templates/stormpath/register.html</a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix/verify.html">/templates/stormpath/verify.html</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Spring Boot Stormpath Web Starter</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Tutorial</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/tutorial.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will take you from zero to a Stormpath enabled application featuring Spring Boot WebMVC and Spring Security integration.</p>
<p>It should take about 30 minutes from start to finish. If you are looking for a bare bones intro to using Stormpath and
Spring Boot, check out the <a class="reference internal" href="quickstart.html"><em>Quickstart</em></a>.</p>
<p>If you&#8217;ve already gone through the quickstart, jump over to the <a class="reference internal" href="#spring-boot-meet-stormpath"><span>Spring Boot: Meet Stormpath</span></a> section.</p>
<p>We will be referring to the tutorial code found <a class="reference external" href="https://github.com/stormpath/stormpath-sdk-java/tree/master/tutorials/spring-boot">here</a>.</p>
<p>All of the code in the tutorial makes use of the <code class="docutils literal"><span class="pre">stormpath-default-spring-boot-starter</span></code>. This starter has it all:
Spring Boot, Spring Web MVC, Spring Security and the Thymeleaf templating engine - all integrated with Stormpath. Component features,
such as Spring Security, can easily be disabled through the use of properties or via annotations. (You&#8217;ll see an example of disabling
Spring Security with properties in the <a class="reference internal" href="#spring-boot-meet-stormpath"><span>Spring Boot: Meet Stormpath</span></a> section).</p>
<p>Topics:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#get-an-api-key" id="id18">Get an API Key</a></li>
<li><a class="reference internal" href="#spring-boot-meet-stormpath" id="id19">Spring Boot: Meet Stormpath</a></li>
<li><a class="reference internal" href="#some-access-controls" id="id20">Some Access Controls</a></li>
<li><a class="reference internal" href="#spring-security-meet-stormpath" id="id21">Spring Security: Meet Stormpath</a></li>
<li><a class="reference internal" href="#spring-security-refined" id="id22">Spring Security Refined</a></li>
<li><a class="reference internal" href="#a-finer-grain-of-control" id="id23">A Finer Grain of Control</a></li>
<li><a class="reference internal" href="#advanced-spring-security-integration" id="id24">Advanced Spring Security Integration</a></li>
<li><a class="reference internal" href="#wrapping-up" id="id25">Wrapping Up</a></li>
</ul>
</div>
<div class="section" id="get-an-api-key">
<span id="get-api-key"></span><h2><a class="toc-backref" href="#id18">Get an API Key</a><a class="headerlink" href="#get-an-api-key" title="Permalink to this headline">¶</a></h2>
<p>All communication with Stormpath must be authenticated with an API Key.</p>
<ol class="arabic">
<li><p class="first">If you haven’t already, <a class="reference external" href="https://api.stormpath.com/register">sign up for Stormpath for free</a>.  You’ll be sent a verification email.</p>
</li>
<li><p class="first">Click the link in the verification email.</p>
</li>
<li><p class="first">Log in to the <a class="reference external" href="https://api.stormpath.com">Stormpath Admin Console</a> using the email address and password you used during registration.</p>
</li>
<li><p class="first">Click the <strong>Create API</strong> Key or <strong>Manage Existing Keys</strong> button in the middle of the page.</p>
</li>
<li><p class="first">Under <strong>Security Credentials</strong>, click <strong>Create API Key</strong>.</p>
<p>This will generate your API Key and download it to your computer as an <code class="docutils literal"><span class="pre">apiKey.properties</span></code> file.</p>
</li>
<li><p class="first">Save the file in your home directory in the following location:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">~/.stormpath/apiKey.properties</span></code> on Unix, Linux and Mac OS</li>
<li><code class="docutils literal"><span class="pre">C:\Users\YOUR_USERNAME\.stormpath\apiKey.properties</span></code> on Windows</li>
</ul>
</li>
<li><p class="first">Change the file permissions to ensure only you can read this file and not accidentally write or modify it. For example:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chmod go-rwx ~/.stormpath/apiKey.properties
<span class="nv">$ </span>chmod u-w ~/.stormpath/apiKey.properties
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>On Windows, you can <a class="reference external" href="http://msdn.microsoft.com/en-us/library/bb727008.aspx">set file permissions similarly</a>.</p>
</div>
<div class="section" id="spring-boot-meet-stormpath">
<span id="id2"></span><h2><a class="toc-backref" href="#id19">Spring Boot: Meet Stormpath</a><a class="headerlink" href="#spring-boot-meet-stormpath" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s fire up a basic Spring Boot Web application. The code for this section can be found <a class="reference external" href="https://github.com/stormpath/stormpath-sdk-java/tree/master/tutorials/spring-boot/00-the-basics">here</a>.</p>
<p>Note: This assumes you have your <code class="docutils literal"><span class="pre">apiKey.properties</span></code> file in the standard location: <code class="docutils literal"><span class="pre">~/.stormpath/apiKey.properties</span></code>.</p>
<p>For a maven build and run, do this:</p>
<div class="highlight-bash"><div class="highlight"><pre>mvn clean package
mvn spring-boot:run
</pre></div>
</div>
<p>For a gradle build and run, do this:</p>
<div class="highlight-bash"><div class="highlight"><pre>gradle clean build
java -jar build/libs/00-the-basics-0.1.0.jar
</pre></div>
</div>
<p>You should now be able to browse to <a class="reference external" href="http://localhost:8080">http://localhost:8080</a> and see a welcome message with your Stormpath application&#8217;s name.</p>
<p>This application has just two code files and a properties file in it. Here&#8217;s the structure:</p>
<div class="highlight-bash"><div class="highlight"><pre>.
<span class="sb">`</span>-- src
   <span class="sb">`</span>-- main
       <span class="p">|</span>-- java
       <span class="p">|</span>   <span class="sb">`</span>-- com
       <span class="p">|</span>       <span class="sb">`</span>-- stormpath
       <span class="p">|</span>           <span class="sb">`</span>-- tutorial
       <span class="p">|</span>               <span class="p">|</span>-- controller
<span class="hll">       <span class="p">|</span>               <span class="p">|</span>   <span class="sb">`</span>-- HelloController.java
</span><span class="hll">       <span class="p">|</span>               <span class="sb">`</span>-- Application.java
</span>       <span class="sb">`</span>-- resources
           <span class="sb">`</span>-- application.properties
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">Application.java</span></code> is a most basic Spring Boot application file with a <code class="docutils literal"><span class="pre">main</span></code> method and the <code class="docutils literal"><span class="pre">&#64;SpringBootApplication</span></code>
annotation:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll"><span class="nd">@SpringBootApplication</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span>  <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p><code class="docutils literal"><span class="pre">HelloController.java</span></code> is a little more interesting:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
<span class="hll">        <span class="n">Application</span> <span class="n">app</span> <span class="o">=</span> <span class="n">ApplicationResolver</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">getApplication</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>
</span><span class="hll">        <span class="k">return</span> <span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">app</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
</span>    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Here we have our first taste of Stormpath in action. On line 5 we are getting hold of the Stormpath application and on
line 6 we are obtaining its name for display.</p>
<p>For this example, we don&#8217;t want Spring Security locking everything down, which is its default behavior. So, we will simply
disable it. That&#8217;s where the <code class="docutils literal"><span class="pre">application.properties</span></code> files comes in:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">stormpath</span><span class="o">.</span><span class="na">spring</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">security</span><span class="o">.</span><span class="na">basic</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="kc">false</span>
</pre></div>
</td></tr></table></div>
<p>The first line disables Stormpath&#8217;s hooks into Spring Security and the second line disables Spring Security itself.</p>
<p>Pretty simple setup, right? In the next section, we&#8217;ll layer in some flow logic based on logged-in state. And then we
will refine that to make use of all the Spring Security has to offer in making our lives easier.</p>
</div>
<div class="section" id="some-access-controls">
<span id="id4"></span><h2><a class="toc-backref" href="#id20">Some Access Controls</a><a class="headerlink" href="#some-access-controls" title="Permalink to this headline">¶</a></h2>
<p>I am going to say something a little radical here: Don&#8217;t use the code in this section in real life! &#8220;Why have it at all?&#8221;, you may ask.</p>
<p>In the next section, we will talk about having access controls the &#8220;right&#8221; way by using Stormpath&#8217;s integration with Spring Security.</p>
<p>The purpose of this section is to demonstrate the manual labor required in &#8220;rolling your own&#8221; permissions assertion layer.
Feel free to skip right over to the <a class="reference internal" href="#spring-security-meet-stormpath"><span>Spring Security: Meet Stormpath</span></a> section.</p>
<p>The code for this section can be found <a class="reference external" href="https://github.com/stormpath/stormpath-sdk-java/tree/master/tutorials/spring-boot/01-some-access-controls">here</a>.</p>
<p>Let&#8217;s say there&#8217;s a restricted page that you only want authenticated users to have access to. We can determine that someone
is logged in simply by obtaining an <code class="docutils literal"><span class="pre">Account</span></code> object. If it&#8217;s <code class="docutils literal"><span class="pre">null</span></code>, the user is not logged in. If it resolves to an
object, then the user is logged in.</p>
<p>Let&#8217;s take a look at the updated <code class="docutils literal"><span class="pre">HelloController.java</span></code> file:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">));</span>
        <span class="k">return</span> <span class="s">&quot;home&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/restricted&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">restricted</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
<span class="hll">        <span class="k">if</span> <span class="o">(</span><span class="n">AccountResolver</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">getAccount</span><span class="o">(</span><span class="n">req</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span>            <span class="k">return</span> <span class="s">&quot;restricted&quot;</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="s">&quot;redirect:/login&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>If we are able to get an account via <code class="docutils literal"><span class="pre">AccountResolver.INSTANCE.getAccount(req)</span></code>, then we return the <code class="docutils literal"><span class="pre">restricted</span></code>
template. Otherwise, we redirect to <code class="docutils literal"><span class="pre">/login</span></code>.</p>
<p>The code from this section also incorporates some other cool features of
<a class="reference external" href="https://github.com/stormpath/stormpath-sdk-java/tree/master/extensions/spring/boot/stormpath-default-spring-boot-starter">stormpath-default-spring-boot-starter</a>.</p>
<p>It makes use of Thymeleaf templates. Support for Thymeleaf is built in to <code class="docutils literal"><span class="pre">stormpath-default-spring-boot-starter</span></code>. In
fact, the default views for login, register and forgot, change and verify are all Thymeleaf templates.</p>
<p>It also makes use of some settings in <code class="docutils literal"><span class="pre">application.properties</span></code>.</p>
<p>By default, the next page after <code class="docutils literal"><span class="pre">/logout</span></code> is <code class="docutils literal"><span class="pre">/login?status=logout</span></code>. For this example, an alternate is set using:</p>
<p><code class="docutils literal"><span class="pre">stormpath.web.logout.nextUri</span> <span class="pre">=</span> <span class="pre">/?status=logout</span></code></p>
<p>So, in this case, when you logout you will be redirected to the homepage with a message that will be shown on the page.</p>
<p>You can see this in action by running this example:</p>
<div class="highlight-bash"><div class="highlight"><pre>mvn clean package
mvn spring-boot:run
</pre></div>
</div>
<p>Now, let&#8217;s take a look at using Spring Security to restrict access.</p>
</div>
<div class="section" id="spring-security-meet-stormpath">
<span id="id6"></span><h2><a class="toc-backref" href="#id21">Spring Security: Meet Stormpath</a><a class="headerlink" href="#spring-security-meet-stormpath" title="Permalink to this headline">¶</a></h2>
<p>With the Stormpath Spring Security integration, you can use its standard syntax to restrict access to endpoints and
methods.</p>
<p>The official Spring Security documentation is <a class="reference external" href="http://projects.spring.io/spring-security/">here</a>.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p>You may encounter a circular redirect in your Google Chrome browser when you are in the process of developing your
Spring Boot + Spring Security + Stormpath application.</p>
<p>This is due to a known issue with Google Chrome whereby it aggressively caches <code class="docutils literal"><span class="pre">302</span></code> redirects.</p>
<p>The solution is to clear cache or use an Icognito window while testing.</p>
<p><a class="reference external" href="http://kmarsden.com/chrome-redirect-cache/">Here</a> a good post describing the issue and its solution further.</p>
<p class="last"><strong>Note:</strong> This will never occur in a production release environment.</p>
</div>
<p>Let&#8217;s take a look at the additions and changes to the project.
The code for this section can be found <a class="reference external" href="https://github.com/stormpath/stormpath-sdk-java/tree/master/tutorials/spring-boot/02-spring-security-ftw">here</a>.</p>
<p>We&#8217;ve added a configuration file called <code class="docutils literal"><span class="pre">SpringSecurityWebAppConfig.java</span></code>. How does Spring know it&#8217;s a configuration file?
It has the <code class="docutils literal"><span class="pre">&#64;Configuration</span></code> annotation:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringSecurityWebAppConfig</span> <span class="kd">extends</span> <span class="n">StormpathWebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doConfigure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
            <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">).</span><span class="na">permitAll</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Why have this configuration? Spring Security expects things to be, well - secured. If there is not a class that extends
<code class="docutils literal"><span class="pre">WebSecurityConfigurerAdapter</span></code> in the application, Spring Security will protect <em>every</em> pathway and will provide a default
basic authentication popup to your browser. In order to easily hook into the Stormpath Spring Security integration, you
can extend <code class="docutils literal"><span class="pre">StormpathWebSecurityConfigurerAdapter</span></code> which itself extends <code class="docutils literal"><span class="pre">WebSecurityConfigurerAdapter</span></code>. NOTE: Please
refer to the <a class="reference internal" href="#advanced-spring-security-integration"><span>Advanced Spring Security Integration</span></a> section for how to configure your app <em>without</em> extending
<code class="docutils literal"><span class="pre">StormpathWebSecurityConfigurerAdapter</span></code>.</p>
<p>Based on the <code class="docutils literal"><span class="pre">SpringSecurityWebAppConfig</span></code> above, we will permit access to the homepage. Any other paths will fall back
to the default of being secured - you would be redirected to the Stormpath login page. We are going to further protect
access to a service by requiring group membership with the <code class="docutils literal"><span class="pre">&#64;PreAuthorize</span></code> annotation (as you&#8217;ll see below).</p>
<p>Next, we&#8217;ve added a service called <code class="docutils literal"><span class="pre">HelloService.java</span></code>:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">MY_GROUP</span> <span class="o">=</span> <span class="s">&quot;GROUP_HREF_HERE&quot;</span><span class="o">;</span>

<span class="hll">    <span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&quot;hasRole(&#39;&quot;</span> <span class="o">+</span> <span class="n">MY_GROUP</span> <span class="o">+</span> <span class="s">&quot;&#39;)&quot;</span><span class="o">)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">account</span><span class="o">.</span><span class="na">getGivenName</span><span class="o">()</span> <span class="o">+</span>
            <span class="s">&quot;. You have the required persmissions to access this restricted resource.&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>With the Stormpath Spring Security integration, roles are tied to Stormpath Groups. A Stormpath Group has a unique
URL (aka href) to identify it. Line 5 above ensures that only members of the group (identified by the URL you put in for the
<code class="docutils literal"><span class="pre">MY_GROUP</span></code> variable) can access the <code class="docutils literal"><span class="pre">sayHello</span></code> method.</p>
<p>If the authenticated user is not in the specified group, a <code class="docutils literal"><span class="pre">403</span></code> (forbidden) status will be returned. This will
automatically redirect to <code class="docutils literal"><span class="pre">/error</span></code>, which gets handled by our <code class="docutils literal"><span class="pre">RestrictedErrorController.java</span></code>.
This returns a nicely formatted Thymeleaf template.</p>
<p>With the service defined, we can incorporate it into our controller, <code class="docutils literal"><span class="pre">HellController.java</span></code>:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>

<span class="hll">    <span class="nd">@Autowired</span>
</span><span class="hll">    <span class="kd">private</span> <span class="n">HelloService</span> <span class="n">helloService</span><span class="o">;</span>
</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">));</span>
        <span class="k">return</span> <span class="s">&quot;home&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/restricted&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">restricted</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
<span class="hll">        <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">helloService</span><span class="o">.</span><span class="na">sayHello</span><span class="o">(</span>
</span><span class="hll">            <span class="n">AccountResolver</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">.</span><span class="na">getAccount</span><span class="o">(</span><span class="n">req</span><span class="o">)</span>
</span><span class="hll">        <span class="o">);</span>
</span>        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&quot;restricted&quot;</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Lines 4 and 5 use the Spring Autowiring capability to make the <code class="docutils literal"><span class="pre">HelloService</span></code> available in the <code class="docutils literal"><span class="pre">HelloController</span></code>.</p>
<p>Lines 15 - 17 attempt to call the <code class="docutils literal"><span class="pre">sayHello</span></code> method.</p>
<p>Give this a spin yourself. Make sure that you replace the <code class="docutils literal"><span class="pre">MY_GROUP</span></code> value in <code class="docutils literal"><span class="pre">HelloService</span></code> with the actual URL to the group you&#8217;ve
setup in the Stormpath Admin Console.</p>
<div class="highlight-bash"><div class="highlight"><pre>mvn clean package
mvn spring-boot:run
</pre></div>
</div>
<p>In the next section, we&#8217;ll add a small amount of code to be able to dynamically set the Group reference and make the code more readable.</p>
</div>
<div class="section" id="spring-security-refined">
<span id="id10"></span><h2><a class="toc-backref" href="#id22">Spring Security Refined</a><a class="headerlink" href="#spring-security-refined" title="Permalink to this headline">¶</a></h2>
<p>The code for this section can be found <a class="reference external" href="https://github.com/stormpath/stormpath-sdk-java/tree/master/tutorials/spring-boot/03-spring-security-refined">here</a>.</p>
<p>In the previous section, we hard-coded the Stormpath group href into <code class="docutils literal"><span class="pre">HelloService</span></code>.</p>
<p>This is cumbersome in a real world situation where you may have multiple environments (dev, stage, prod, etc.).
You don&#8217;t want to have to change source, recompile and deploy for a new environment or when you change a group in Stormpath.</p>
<p>With a little bit of Spring magic and Stormpath&#8217;s super flexible configuration mechanism, we can make this much more dynamic.</p>
<p>Take a look at the updated <code class="docutils literal"><span class="pre">HelloService</span></code> class:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloService</span> <span class="o">{</span>
<span class="hll">    <span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&quot;hasRole(@roles.USER)&quot;</span><span class="o">)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">account</span><span class="o">.</span><span class="na">getGivenName</span><span class="o">()</span> <span class="o">+</span>
            <span class="s">&quot;. You have the required permissions to access this restricted resource.&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Spring has an expression language called
<a class="reference external" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/expressions.html">SpringEL</a>, that let&#8217;s you
reference objects and properties found in your Spring app in a number of ways.</p>
<p>The <code class="docutils literal"><span class="pre">&#64;</span></code> symbol is used to refer to a bean that is in the Spring context. On line 3 above, we are referencing the
<code class="docutils literal"><span class="pre">USER</span></code> property of the <code class="docutils literal"><span class="pre">roles</span></code> bean. The implication is that there is a <code class="docutils literal"><span class="pre">USER</span></code> role defined somewhere that Spring
can resolve.</p>
<p>Remember, in the context of Stormpath, that must ultimately resolve to a fully qualified href that refers to a Stormpath group.</p>
<p>Let&#8217;s now take a look at this <code class="docutils literal"><span class="pre">roles</span></code> bean.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="hll"><span class="nd">@Component</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Roles</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">USER</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">Roles</span><span class="o">(</span><span class="n">Environment</span> <span class="n">env</span><span class="o">)</span> <span class="o">{</span>
<span class="hll">        <span class="n">USER</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;stormpath.authorized.group.user&quot;</span><span class="o">);</span>
</span>    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Line 1 uses the standard Spring <code class="docutils literal"><span class="pre">&#64;Component</span></code> annotation to instantiate this object and make it available as a bean in
the application.</p>
<p>By default, Spring will name the bean in context using camelcase conventions. Therefore the bean will be named <code class="docutils literal"><span class="pre">roles</span></code>.</p>
<p>We use some Spring magic on lines 5 and 6 to pass the <code class="docutils literal"><span class="pre">Environment</span></code> into the constructor using the <cite>&#64;Autowired</cite> annotation.</p>
<p>In the constructor, we set the <code class="docutils literal"><span class="pre">USER</span></code> variable to the value of the environment property called <code class="docutils literal"><span class="pre">stormpath.authorized.group.user</span></code>.</p>
<p>The expectation is that the <code class="docutils literal"><span class="pre">stormpath.authorized.group.user</span></code> environment variable will hold the fully qualified href to the
Stormpath group that backs the <code class="docutils literal"><span class="pre">USER</span></code> role.</p>
<p>With Spring, you can define the <code class="docutils literal"><span class="pre">stormpath.authorized.group.user</span></code> in the <code class="docutils literal"><span class="pre">application.properties</span></code> file and that property will be available
to your app.</p>
<p>Now, for the Stormpath magic. You can also have a system environment variable named <code class="docutils literal"><span class="pre">STORMPATH_AUTHORIZED_GROUP_USER</span></code>.
Behind the scenes, Stormpath will convert that system environment variable to a Spring environment variable named
<code class="docutils literal"><span class="pre">stormpath.authorized.group.user</span></code>.</p>
<p>This makes it very easy to change the group <code class="docutils literal"><span class="pre">USER</span></code> role href in different deployment environments without having to
reconfigure and recompile your code.</p>
<p>Additionally, the <code class="docutils literal"><span class="pre">Roles</span></code> class is very easily extended. Let&#8217;s say you want to add an <code class="docutils literal"><span class="pre">ADMIN</span></code> role into the mix. You
could update the <code class="docutils literal"><span class="pre">Roles</span></code> class like so:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre>    <span class="nd">@Component</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Roles</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">USER</span><span class="o">;</span>
<span class="hll">        <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ADMIN</span><span class="o">;</span>
</span>
        <span class="nd">@Autowired</span>
        <span class="kd">public</span> <span class="nf">Roles</span><span class="o">(</span><span class="n">Environment</span> <span class="n">env</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">USER</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;stormpath.authorized.group.user&quot;</span><span class="o">);</span>
<span class="hll">            <span class="n">ADMIN</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&quot;stormpath.authorized.group.admin&quot;</span><span class="o">);</span>
</span>        <span class="o">}</span>
    <span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>You can try this out for yourself by running this example like so:</p>
<div class="highlight-bash"><div class="highlight"><pre>mvn clean package

<span class="nv">STORMPATH_AUTHORIZED_GROUP_USER</span><span class="o">=</span>&lt;href to your group in Stormpath&gt; <span class="se">\</span>
mvn spring-boot:run
</pre></div>
</div>
<p>In this example, we are also taking advantage of Stormpath&#8217;s configuration mechanism. This reduces boilerplate code.</p>
<p>Next up: An even finer grain of control using Spring Security permissions.</p>
</div>
<div class="section" id="a-finer-grain-of-control">
<span id="id12"></span><h2><a class="toc-backref" href="#id23">A Finer Grain of Control</a><a class="headerlink" href="#a-finer-grain-of-control" title="Permalink to this headline">¶</a></h2>
<p>The code for this section can be found <a class="reference external" href="https://github.com/stormpath/stormpath-sdk-java/tree/master/tutorials/spring-boot/04-a-finer-grain-of-control">here</a>.</p>
<p>So far, we&#8217;ve restricted access to certain methods with the <cite>hasRole</cite> clause of the <cite>&#64;PreAuthorize</cite> annotation. In this
section, we are going to look at examples that give a finer grain of control and demonstrate how Stormpath hooks into
Spring Security.</p>
<p>As before, we allow unauthenticated access to the homepage <code class="docutils literal"><span class="pre">/</span></code> in <code class="docutils literal"><span class="pre">SpringSecurityWebAppConfig.java</span></code>.</p>
<p>For more on <code class="docutils literal"><span class="pre">HttpSecurity</span></code> with Spring Security, look <a class="reference external" href="http://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#jc-httpsecurity">here</a>.</p>
<p>We&#8217;ve added a new method to our <code class="docutils literal"><span class="pre">HelloController</span></code>. It does not call out any other authorizaton requirements. As such,
anyone logged in will be able to access <code class="docutils literal"><span class="pre">/me</span></code>. Furthermore, anyone NOT logged in trying to access <code class="docutils literal"><span class="pre">/me</span></code> will automatically
be redirected to the <code class="docutils literal"><span class="pre">/login</span></code> view.</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/me&quot;</span><span class="o">)</span>
    <span class="n">String</span> <span class="nf">me</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;me&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Try it out. Launch the application as before, and then browse to: <code class="docutils literal"><span class="pre">http://localhost:8080/me</span></code>. You will be redirected to the <code class="docutils literal"><span class="pre">/login</span></code>
and then after you login to a valid Stormpath Account, you will automatically be brought back to <code class="docutils literal"><span class="pre">/me</span></code>. That&#8217;s the StormPath magic at work!</p>
<p>Now, we&#8217;ll look at fine grained controls using Spring Security permissions connected to Stormpath custom data.</p>
<p>Every first class object in Stormpath can have custom data associated with it. For instance, you can have custom data at the Group level as well
as at the Account level.</p>
<p>In general, custom data can be completely arbitrary JSON data of any kind. There&#8217;s a special key that can be used at the top level of custom data
that the Spring Security <code class="docutils literal"><span class="pre">hasPermission</span></code> clause will respond to. Note: this does not preclude you in any way from having other custom data.</p>
<p>Let&#8217;s take a look at the updated <code class="docutils literal"><span class="pre">HelloService</span></code>:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloService</span> <span class="o">{</span>
<span class="hll">    <span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&quot;hasRole(@roles.USER) and hasPermission(&#39;say&#39;, &#39;hello&#39;)&quot;</span><span class="o">)</span>
</span>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">account</span><span class="o">.</span><span class="na">getGivenName</span><span class="o">()</span> <span class="o">+</span>
            <span class="s">&quot;. You have the required permissions to access this restricted resource.&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Notice that in addition to the <code class="docutils literal"><span class="pre">hasRole</span></code> clause, we now have added: <code class="docutils literal"><span class="pre">hasPermission('say',</span> <span class="pre">'hello')</span></code>. We are saying that
in addition to the user being in the group identified by <code class="docutils literal"><span class="pre">&#64;roles.USER</span></code>, they must also have the permission to say hello.</p>
<p>This is connected to Stormpath by having the following custom data present:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;springSecurityPermissions&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;say:hello&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">springSecurityPermissions</span></code> is the special key we talked about above. Its value is an array of strings each of which
conforms to the following format: <code class="docutils literal"><span class="pre">target:permission</span></code>. In this case, the target is <em>say</em> and the permission is <em>hello</em>.</p>
<p>Note that you can put this custom data at the group level, in which case it would apply to everyone in the group or you
could have it present for individual accounts. As long as the condition declared by the <code class="docutils literal"><span class="pre">hasPermission</span></code> clause is met
(as well as the user belonging to the right group), the user will have access to the <code class="docutils literal"><span class="pre">sayHello</span></code> method.</p>
<p>You could have many specific permissions attached to the <code class="docutils literal"><span class="pre">say</span></code> target. If you wanted to grant a user or group access to
any permission in the <code class="docutils literal"><span class="pre">say</span></code> target, you could take advantage of Stormpath&#8217;s wildcard permissions syntax. That looks like:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;springSecurityPermissions&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;say:*&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you had one method protected by: <code class="docutils literal"><span class="pre">hasPermission('say',</span> <span class="pre">'hello')</span></code> and another method protected by:
<code class="docutils literal"><span class="pre">hasPermission('say',</span> <span class="pre">'goodbye')</span></code>, the above <code class="docutils literal"><span class="pre">customData</span></code> would grant the user or group entry into both methods.</p>
<p>Try this out for yourself. In the Stormpath Admin Console, add two user accounts to the group you&#8217;ve been using in the
previous examples.</p>
<img alt="_images/group.png" src="_images/group.png" />
<p>Add the custom data to one of the users, but not the other.</p>
<img alt="_images/user-custom-data.png" src="_images/user-custom-data.png" />
<img alt="_images/user-no-custom-data.png" src="_images/user-no-custom-data.png" />
<p>You will find that, although both users are in the right group, only the one with the <code class="docutils literal"><span class="pre">springSecurityPermissions</span></code> custom data
will be able to get to the <code class="docutils literal"><span class="pre">/restricted</span></code> page.</p>
</div>
<div class="section" id="advanced-spring-security-integration">
<span id="id15"></span><h2><a class="toc-backref" href="#id24">Advanced Spring Security Integration</a><a class="headerlink" href="#advanced-spring-security-integration" title="Permalink to this headline">¶</a></h2>
<p>There are times when you will want to hook into the Stormpath Spring Security Integration at a deeper level. Or, perhaps you
have a scenario where you are already extending a class from another library and do not have the option of extending <code class="docutils literal"><span class="pre">StormpathWebSecurityConfigurerAdapter</span></code>.</p>
<p>In these situations, your <code class="docutils literal"><span class="pre">&#64;Configuration</span></code> class can interact with the <code class="docutils literal"><span class="pre">StormpathWebSecurityConfigurer</span></code> directly.</p>
<p>Let&#8217;s say that we want to set it up so that only authenticated users can get to <code class="docutils literal"><span class="pre">/restrcited</span></code> and that unauthenticated users can get anywhere
else in our application.</p>
<p>Take a look what this looks like when not extending <code class="docutils literal"><span class="pre">StormpathWebSecurityConfigurer</span></code>:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringSecurityWebAppConfig</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
<span class="hll">    <span class="n">StormpathWebSecurityConfigurer</span> <span class="n">stormpathWebSecurityConfigurer</span><span class="o">;</span>
</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="hll">        <span class="n">stormpathWebSecurityConfigurer</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">http</span><span class="o">);</span>
</span>        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
            <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&quot;/restricted&quot;</span><span class="o">).</span><span class="na">fullyAuthenticated</span><span class="o">()</span>
            <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&quot;/**&quot;</span><span class="o">).</span><span class="na">permitAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="hll">        <span class="n">stormpathWebSecurityConfigurer</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">auth</span><span class="o">);</span>
</span>    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">WebSecurity</span> <span class="n">web</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<span class="hll">        <span class="n">stormpathWebSecurityConfigurer</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">web</span><span class="o">);</span>
</span>    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>On lines 4 - 5, we use Spring&#8217;s <code class="docutils literal"><span class="pre">&#64;Autowired</span></code> capability to get access to the <code class="docutils literal"><span class="pre">StormpathWebSecurityConfigurer</span></code>.</p>
<p>It&#8217;s critical that you implement each of the three <code class="docutils literal"><span class="pre">configure</span></code> methods above and that you call Stormpath&#8217;s <code class="docutils literal"><span class="pre">configure</span></code> method
within before you call any methods for your own configuration.</p>
<p>Notice above that on line 9 we call <code class="docutils literal"><span class="pre">stormpathWebSecurityConfigurer.configure(http)</span></code> and only then do we call methods
on the <code class="docutils literal"><span class="pre">HttpSecurity</span></code> object.</p>
<p>Again, in most situations, you will want to simply extend the <code class="docutils literal"><span class="pre">StormpathWebSecurityConfigurerAdapter</span></code>. The above code
would look like this:</p>
<div class="highlight-java"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringSecurityWebAppConfig</span> <span class="kd">extends</span> <span class="n">StormpathWebSecurityConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doConfigure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
            <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
            <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&quot;/restricted&quot;</span><span class="o">).</span><span class="na">fullyAuthenticated</span><span class="o">()</span>
            <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&quot;/**&quot;</span><span class="o">).</span><span class="na">permitAll</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>In this case, you are overriding the <code class="docutils literal"><span class="pre">doConfigure</span></code> method. Stormpath&#8217;s <code class="docutils literal"><span class="pre">StormpathWebSecurityConfigurerAdapter.configure</span></code> method
does the housekeeping it needs to for the Stormpath configuration and then calls the <code class="docutils literal"><span class="pre">doConfigure</span></code> method that you&#8217;ve
overridden.</p>
</div>
<div class="section" id="wrapping-up">
<span id="id16"></span><h2><a class="toc-backref" href="#id25">Wrapping Up</a><a class="headerlink" href="#wrapping-up" title="Permalink to this headline">¶</a></h2>
<p>We hope this tutorial has been of value to you in learning about Stormpath&#8217;s integration with Spring Security for Spring Boot
applications.</p>
<p>You can use the Stormpath Spring Security integration in contexts other than Spring Boot as well. For instance, you could
write a REST API that makes use of Spring Security that has no web layer.</p>
<p>Take a look at the <a class="reference external" href="/java/apidocs">javadocs</a> as well as the other code examples
<a class="reference external" href="https://github.com/stormpath/stormpath-sdk-java/tree/master/examples">here</a> for more information on all that the
Stormpath Java SDK has to offer.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="config.html" class="btn btn-neutral float-right" title="Configuration">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="quickstart.html" class="btn btn-neutral" title="Quickstart"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Stormpath, Inc..
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.RC5.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
   
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-29159574-1', 'auto');
    ga('send', 'pageview');
  </script>
  <script type="text/javascript">
    (function(d,s,i,r) {
        if (d.getElementById(i)){return;}
        var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
        n.id=i;n.src='//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/475298.js';
        e.parentNode.insertBefore(n, e);
    })(document,"script","hs-analytics",300000);
  </script>
  <script type="text/javascript">
    var _kmq = _kmq || [];
    var _kmk = _kmk || '684b854336bd3a6523260ebd991eec06b18b929a';
    function _kms(u){
        setTimeout(function(){
            var d = document, f = d.getElementsByTagName('script')[0],
                    s = d.createElement('script');
            s.type = 'text/javascript'; s.async = true; s.src = u;
            f.parentNode.insertBefore(s, f);
        }, 1);
    }
    _kms('//i.kissmetrics.com/i.js');
    _kms('//doug1izaerwt3.cloudfront.net/' + _kmk + '.1.js');
  </script>
  <script src="//cdn.optimizely.com/js/225847041.js"></script>


</body>
</html>