
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Integrating Stormpath with Facebook and Google - Stormpath</title>
  <meta name="author" content="Stormpath, Inc.">

  
  <meta name="description" content="In this guide, we discuss how to set up Stormpath to communicate to Google and Facebook to retrieve user profiles from the social networks and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://stormpath.github.io/guides/social-integrations">
  <link href="/favicon.ico" rel="icon">

  <style>
  @import url("/stylesheets/normalize.css?mrrrji");
  @import url("/stylesheets/wireframes.css?mrrrji");
  @import url("/stylesheets/html-elements.css?mrrrji");
  @import url("/stylesheets/tabs.css?mrrrji");
  @import url("/stylesheets/tinybox2.css?mrrrji");
  @import url("/stylesheets/pages.css?mrrrji");
  @import url("/stylesheets/docs.css?mrrrji");
  @import url("/stylesheets/blocks.css?mrrrji");
  @import url("/stylesheets/navigation.css?mrrrji");
  @import url("/stylesheets/views-styles.css?mrrrji");
  @import url("/stylesheets/nodes.css?mrrrji");
  @import url("/stylesheets/comments.css?mrrrji");
  @import url("/stylesheets/forms.css?mrrrji");
  @import url("/stylesheets/fields.css?mrrrji");
  @import url("/stylesheets/layouts/responsive-sidebars.css?mrrrji");
  </style>

  <link href="/atom.xml" rel="alternate" title="Stormpath" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!-- Fix FOUC-->
   <style type="text/css">
    .hidden {display:none;}
  </style>
  <script type="text/javascript">
    $('html').addClass('hidden');
    $(document).ready(function() {
      $('html').show();
     });  
   </script>

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Covered+By+Your+Grace|Open+Sans:300italic,400italic,600italic,700italic,800italic,300,400,600,700,800" media="all" />

<!--[if lt IE 9]>
<script src="/javascripts/html5-respond.js"></script>
<![endif]-->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29159574-1']);
  _gaq.push(['_setDomainName', 'stormpath.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<!-- kissmetrics -->
<script type="text/javascript">
  var _kmq = _kmq || [];
  var _kmk = _kmk || '684b854336bd3a6523260ebd991eec06b18b929a';
  function _kms(u){
    setTimeout(function(){
      var d = document, f = d.getElementsByTagName('script')[0],
      s = d.createElement('script');
      s.type = 'text/javascript'; s.async = true; s.src = u;
      f.parentNode.insertBefore(s, f);
    }, 1);
  }
  _kms('//i.kissmetrics.com/i.js');
  _kms('//doug1izaerwt3.cloudfront.net/' + _kmk + '.1.js');
</script>

<!-- Optimizely -->
<script src="//cdn.optimizely.com/js/225847041.js"></script>

  

</head>

<body  class="not-front  node-type-documentation  ">
<!-- Qualaroo for stormpath.com -->
<script type="text/javascript">var _kiq = _kiq || [];</script>
<script type="text/javascript" src="//s3.amazonaws.com/ki.js/47725/9JM.js" async="true"></script>
      
<script type="text/javascript" src="//assets.zendesk.com/external/zenbox/v2.6/zenbox.js"></script>
<style type="text/css" media="screen, projection">
  @import url(//assets.zendesk.com/external/zenbox/v2.6/zenbox.css);
</style>
<script type="text/javascript">
  if (typeof(Zenbox) !== "undefined") {
    Zenbox.init({
      dropboxID:   "20184231",
      url:         "https://stormpath.zendesk.com",
      tabTooltip:  "Get Help",
      tabImageURL: "/images/tab_questions_black_right.png",
      tabColor:    "689ed0",
      tabPosition: "Right"
    });
  }
</script>


<script src="/javascripts/stormpath_docs.js"></script>
<script type="text/javascript">
	var sp_docs_menu = {};
	
		sp_docs_menu['_includes'] = [];
		
	
		sp_docs_menu['_layouts'] = [];
		
	
		sp_docs_menu['assets'] = [];
		
	
		sp_docs_menu['console'] = [];
		
			sp_docs_menu['console'].push('product-guide');
		
			sp_docs_menu['console'].push('quickstart');
		
	
		sp_docs_menu['errors'] = [];
		
			sp_docs_menu['errors'].push('2000');
		
			sp_docs_menu['errors'].push('2001');
		
			sp_docs_menu['errors'].push('2002');
		
			sp_docs_menu['errors'].push('2003');
		
			sp_docs_menu['errors'].push('2004');
		
			sp_docs_menu['errors'].push('2005');
		
			sp_docs_menu['errors'].push('2006');
		
			sp_docs_menu['errors'].push('2007');
		
			sp_docs_menu['errors'].push('2008');
		
			sp_docs_menu['errors'].push('2009');
		
			sp_docs_menu['errors'].push('2010');
		
			sp_docs_menu['errors'].push('2011');
		
			sp_docs_menu['errors'].push('2012');
		
			sp_docs_menu['errors'].push('2013');
		
			sp_docs_menu['errors'].push('2014');
		
			sp_docs_menu['errors'].push('2015');
		
			sp_docs_menu['errors'].push('2016');
		
			sp_docs_menu['errors'].push('2017');
		
			sp_docs_menu['errors'].push('2018');
		
			sp_docs_menu['errors'].push('2100');
		
			sp_docs_menu['errors'].push('2101');
		
			sp_docs_menu['errors'].push('2102');
		
			sp_docs_menu['errors'].push('2103');
		
			sp_docs_menu['errors'].push('2104');
		
			sp_docs_menu['errors'].push('2105');
		
			sp_docs_menu['errors'].push('2106');
		
			sp_docs_menu['errors'].push('2107');
		
			sp_docs_menu['errors'].push('3000');
		
			sp_docs_menu['errors'].push('3001');
		
			sp_docs_menu['errors'].push('3002');
		
			sp_docs_menu['errors'].push('3003');
		
			sp_docs_menu['errors'].push('3004');
		
			sp_docs_menu['errors'].push('4001');
		
			sp_docs_menu['errors'].push('4002');
		
			sp_docs_menu['errors'].push('5010');
		
			sp_docs_menu['errors'].push('5100');
		
			sp_docs_menu['errors'].push('5101');
		
			sp_docs_menu['errors'].push('5102');
		
			sp_docs_menu['errors'].push('5103');
		
			sp_docs_menu['errors'].push('5104');
		
			sp_docs_menu['errors'].push('5106');
		
			sp_docs_menu['errors'].push('5108');
		
			sp_docs_menu['errors'].push('5110');
		
			sp_docs_menu['errors'].push('5112');
		
			sp_docs_menu['errors'].push('5114');
		
			sp_docs_menu['errors'].push('6100');
		
			sp_docs_menu['errors'].push('6201');
		
			sp_docs_menu['errors'].push('6202');
		
			sp_docs_menu['errors'].push('7200');
		
			sp_docs_menu['errors'].push('7201');
		
			sp_docs_menu['errors'].push('7202');
		
			sp_docs_menu['errors'].push('9000');
		
			sp_docs_menu['errors'].push('9001');
		
			sp_docs_menu['errors'].push('9002');
		
			sp_docs_menu['errors'].push('9003');
		
			sp_docs_menu['errors'].push('9004');
		
			sp_docs_menu['errors'].push('9005');
		
			sp_docs_menu['errors'].push('9006');
		
	
		sp_docs_menu['guides'] = [];
		
			sp_docs_menu['guides'].push('multi-tenant');
		
			sp_docs_menu['guides'].push('social-integrations');
		
	
		sp_docs_menu['home'] = [];
		
	
		sp_docs_menu['how-do-i'] = [];
		
	
		sp_docs_menu['images'] = [];
		
	
		sp_docs_menu['integrations'] = [];
		
	
		sp_docs_menu['java'] = [];
		
			sp_docs_menu['java'].push('product-guide');
		
			sp_docs_menu['java'].push('quickstart');
		
	
		sp_docs_menu['javascripts'] = [];
		
	
		sp_docs_menu['nodejs'] = [];
		
	
		sp_docs_menu['php'] = [];
		
			sp_docs_menu['php'].push('product-guide');
		
			sp_docs_menu['php'].push('quickstart');
		
	
		sp_docs_menu['python'] = [];
		
			sp_docs_menu['python'].push('product-guide');
		
			sp_docs_menu['python'].push('quickstart');
		
	
		sp_docs_menu['rest'] = [];
		
			sp_docs_menu['rest'].push('api');
		
			sp_docs_menu['rest'].push('product-guide');
		
			sp_docs_menu['rest'].push('quickstart');
		
	
		sp_docs_menu['ruby'] = [];
		
			sp_docs_menu['ruby'].push('product-guide');
		
			sp_docs_menu['ruby'].push('quickstart');
		
	
		sp_docs_menu['sample-apps'] = [];
		
	
		sp_docs_menu['stylesheets'] = [];
		
	
</script>

<div id="page">

  <div id="header-wrapper">
  	<header id="header" role="banner" class="container">
      <hgroup id="name-and-slogan">
  <h1 id="site-name">
    <a href="http://www.stormpath.com/" title="Home" rel="home"><span>Stormpath</span></a>
  </h1>
</hgroup><!-- /#name-and-slogan -->

<div id="navigation"><div class="menu-button">Menu</div>
<nav id="main-menu" role="navigation">
  <h2 class="element-invisible">Main menu</h2>
<ul class="links inline clearfix">
<li class="menu-1413 first"><a href="/" title="Documentation">Docs</a></li>
<li class="menu-710"><a href="http://www.stormpath.com/product">Product</a></li>
<li class="menu-709"><a href="http://www.stormpath.com/pricing">Pricing</a></li>
<li class="menu-438"><a href="https://support.stormpath.com/" title="">Support</a></li>
<li class="menu-547"><a href="http://www.jobscore.com/jobs/stormpath" title="Jobs at Stormpath. Join us!">Jobs</a></li>
<li class="menu-556"><a href="http://api.stormpath.com" title="">Log in</a></li>
<li class="menu-1328 last cta-button"><a href="https://api.stormpath.com/register" title="">Sign up</a></li>
</ul>
</nav>
</div>
    </header>
  </div>
  <div id="main-wrapper">
    <div id="main" class="container">
      <div id="main-inner">
        <div id="main-inner-inner">
          <div id="content" class="column" role="main">
            <a id="main-content"></a>
            
              <h1 class="title" id="page-title">Integrating Stormpath with Facebook and Google</h1>
            
          	<p>In this guide, we discuss how to set up Stormpath to communicate to Google and Facebook to retrieve user profiles from the social networks and convert them into Stormpath accounts.</p>

<div class='docs-note'><p>Prerequisite:  Complete one of the <a href="http://docs.stormpath.com/home/">Quickstart Guides</a>.  This will get you familiar with Stormpath and will set up an <code>Application</code> to use with this guide.</p>
</div>


<h2><a id="what-is-stormpath"></a>What is Stormpath?</h2>

<p>Stormpath is a user management API that makes it easy for developers to launch applications with secure, scalable user infrastructure. It automates:</p>

<ul>
<li>User Account registration and login</li>
<li>Authentication and authorization</li>
<li>Flexible, secure user profile data</li>
<li>Group and role management, including pre-built Role-Based Access Control (RBAC)</li>
<li>Best-practice password security and data storage</li>
</ul>


<p>You access Stormpath via a <a href="http://stormpath.com/blog/designing-rest-json-apis">beautiful</a> REST+JSON API or our <a href="http://docs.stormpath.com">language-specific SDKs</a>.</p>

<h2><a id="why-should-i-use-stormpath-to-integrate-login-with-facebook-and-google"></a>Why Should I Use Stormpath to Integrate Login with Facebook and Google?</h2>

<p>Stormpath makes it easy to connect to Google and Facebook in one simple API call. It&rsquo;s a simple and secure way to retrieve user profiles and convert them into to Stormpath accounts so that no matter the service you&rsquo;re using.</p>

<p>From an end-user perspective, it allows the them to log into your application by collecting information from these social networks.</p>

<p>As soon as you have an OAuth token from Google or Facebook, you can pass it to Stormpath.  Stormpath will handle validating the token, importing the user profile into a <code>Directory</code>, syncing user profile, and can enable you to handle use cases such as:</p>

<ul>
<li>Storing an optional password for an imported Facebook / Google account to support email / password authentication</li>
<li>Robust and schema-less user profiles</li>
<li>Using the same API, you can read / write information regardless of what social provider they authenticated with.</li>
</ul>


<h2><a id="how-to-do-integrate-stormpath-with-facebook"></a>How to do Integrate Stormpath with Facebook?</h2>

<p>After you familiarize yourself with Stormpath with one of the <a href="docs.stormpath.com">Quickstart</a> Guides, integrating Stormpath with Facebook and Google requires the following steps:</p>

<ul>
<li>Creating a Social Directory for Facebook</li>
<li>Mapping the Directory as an Account Store to an Application</li>
<li>Accessing an Account with Facebook Tokens</li>
</ul>


<h3><a id="creating-a-social-directory-for-facebook"></a>Creating a Social Directory for Facebook</h3>

<p>A <code>Directory</code> is a top-level storage containers of <code>Accounts</code> in Stormpath. A <code>Directory</code> also manages security policies (like password strength) for the <code>Accounts</code> it contains.  Facebook Directories are a special type of <code>Directory</code> that holds Accounts for Facebook.</p>

<div class='docs-note'><p>Before you can create a Directory for Facebook, it is important that you gather information regarding your application from Facebook.  This information includes Client ID / Client Secret and can be acquired from the developer consoles for <a href="https://developers.facebook.com/">Facebook</a>.</p>
</div>


<p>Creating a directory for Facebook require that you provide information from Facebook as a <code>Provider</code> <a href="http://docs.stormpath.com/rest/product-guide/#facebook-provider-resource">resource</a>.  This information can be use to create the directories from the <a href="https://api.stormpath.com/ui/directories/create">Console</a> or the following curl requests:</p>

<pre><code>curl -X POST --user $YOUR_API_KEY_ID:$YOUR_API_KEY_SECRET \
     -H "Accept: application/json" \
     -H "Content-Type: application/json" \
     -d '{
            "name" : "my-facebook-directory",
            "description" : "A Facebook directory",
            "provider": {
              "providerId": "facebook",
              "clientId":"YOUR_FACEBOOK_CLIENT_ID",
              "clientSecret":"YOUR_FACEBOOK_CLIENT_SECRET"
            }
          }' \
 "https://api.stormpath.com/v1/directories"
</code></pre>

<p>Response:</p>

<pre><code>HTTP/1.1 201 Created
Location: https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q
Content-Type: application/json;charset=UTF-8;

{
  "href" : "https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q",
  "name" : "my-facebook-directory",
  "description" : "A Facebook directory",
  "status" : "ENABLED",
  "tenant" : {
    "href" : "https://api.stormpath.com/v1/tenants/Gh9238fksJlsieJkPkQuW"
  },
  "accounts" : {
    "href" : "https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q/accounts"
  },
  "groups" : {
    "href" : "https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q/groups"
  },
  "provider" : {
    "href" : "https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q/provider"
  }
}
</code></pre>

<h3><a id="mapping-the-directory-as-an-account-store-to-an-application"></a>Mapping the Directory as an Account Store to an Application</h3>

<p>Once a Facebook <code>Directory</code> has been created, it must be mapped to an application as an <code>Account Store</code>.  When an Account Store (which can be a <code>Directory</code> or <code>Group</code>) is mapped to an <code>Application</code>, the accounts in the account store are considered the application’s users and they can login to the application.</p>

<p>Creating an Account Store Mapping can be done through the REST API, SDKs or Admin Console.</p>

<h4>Admin Console</h4>

<p>To manage Account Stores in the Console:</p>

<ol>
<li>Log in to the Stormpath Admin Console</li>
<li>Click the <em>Applications</em> tab</li>
<li>Click the Application&rsquo;s name to which you want to add an Account Store</li>
<li>Click the <em>Account Stores</em> button in the tab bar</li>
<li>Select the Facebook Directory that was created</li>
<li>Click <em>Add Account Store</em></li>
</ol>


<h4>REST API</h4>

<p>Request:</p>

<pre><code>curl -X POST -u $API_KEY_ID:$API_KEY_SECRET \
     -H "Content-Type: application/json;charset=UTF-8" \
     -d '{
           "application": {
             "href": "YOUR_APPLICATION_HREF"
           }
           "accountStore": {
             "href": "YOUR_FACEBOOK_DIRECTORY_HREF"
           }
         }' \
     'https://api.stormpath.com/v1/accountStoreMappings'
</code></pre>

<p>Response:</p>

<pre><code>{
    "href": "https://api.stormpath.com/v1/accountStoreMappings/7Ui2gpn9tV75y3TExAmPLe",
    "accountStore": {
        "href": "https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpExAmPLe"
    },
    "application": {
        "href": "https://api.stormpath.com/v1/applications/Uh8FzIouQ9C8EpcExAmPLe"
    },
    "listIndex": 0,
    "isDefaultAccountStore": false,
    "isDefaultGroupStore": false
}
</code></pre>

<h3><a id="accessing-an-account-with-facebook-tokens"></a>Accessing an Account with Facebook Tokens</h3>

<p>Once a Facebook Directory is mapped to an application, it is now possible to get an <code>Account</code> from Stormpath based on Facebook User Access Tokens.</p>

<p>You need to gather an User Access Token from Facebook before submitting it to Stormpath.  This is possible either by using a <a href="https://developers.facebook.com/docs/facebook-login/access-tokens/#usertokens">Facebook SDK Library</a>, or <a href="https://developers.facebook.com/tools/explorer">Facebook&rsquo;s Graph Explorer</a>.</p>

<div class='docs-note'><p>It is required that your Facebook application request for the <code>email</code> permission from Facebook. If the access token does not grant <code>email</code> permissions, you will not be able to get an <code>Account</code> with an access token.</p>
</div>


<p>Once the <code>User Access Token</code> is gathered, you can get or create the <code>Account</code> HTTP <code>POST</code>ing to the <code>Application</code> accounts collection and specifying <code>providerData</code>.  The <code>providerData</code> JSON object specifies the type of provider and the authorization code as follows:</p>

<pre><code>{
  "providerId": "facebook",
  "accessToken": "%ACCESS_TOKEN_FROM_FACEBOOK%"
}
</code></pre>

<p>The following is how you use <code>providerData</code> to get an <code>Account</code> for a given <code>User Access Token</code>:</p>

<p><strong>Example Request</strong></p>

<pre><code>curl -X POST --user $YOUR_API_KEY_ID:$YOUR_API_KEY_SECRET \
     -H "Accept: application/json" \
     -H "Content-Type: application/json" \
     -d '{
            "providerData": {
              "providerId": "facebook",
              "accessToken": "USER_ACCESS_TOKEN_FROM_FACEBOOK"
            }
          }' \
 "https://api.stormpath.com/v1/applications/YOUR_APP_ID/accounts"
</code></pre>

<p><strong>Example Response</strong></p>

<pre><code>HTTP/1.1 201 Created
Location: https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9
Content-Type: application/json;charset=UTF-8;

{
    "customData": {
        "href": "https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9/customData"
    },
    "directory": {
        "href": "https://api.stormpath.com/v1/directories/U0HJ7YcCeMpRfMcRT8ph"
    },
    "email": "testuser@gmail.com",
    "emailVerificationToken": null,
    "fullName": "Test User",
    "givenName": "Test",
    "groupMemberships": {
        "href": "https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9/groupMemberships"
    },
    "groups": {
        "href": "https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9/groups"
    },
    "href": "https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9",
    "middleName": null,
    "providerData": {
        "href": "https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9/providerData"
    },
    "status": "ENABLED",
    "surname": "User",
    "tenant": {
        "href": "https://api.stormpath.com/v1/tenants/GPpLzIzYkOO68I9i4dx"
    },
    "username": "testuser"
}
</code></pre>

<div class='docs-note'><p>The HTTP Status code when accessing an account based on a Facebook User Access Token will denote if the account was created (HTTP 201) or if it already existed in Stormpath (HTTP 200)</p>
</div>




<div class='docs-note'><p>To <a href="#link-expansion">expand</a> the <code>providerData</code> to get the Access Token for the Account in one HTTP request, add <code>expand=providerData</code> to the URL query parameters.</p>
</div>


<p>Once an <code>Account</code> is retrieved, Stormpath maps common fields for the Facebook User to the  Account.  The access token for any additional calls in the <code>providerData</code> resource and can be retrieved by:</p>

<pre><code>GET https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9/providerData
</code></pre>

<p>The returned <code>providerData</code> will include:</p>

<pre><code>{
  "accessToken": "y29.1.AADN_Xo2hxQflWwsgCSK-WjSw1mNfZiv4", 
  "createdAt": "2014-04-01T17:00:09.154Z", 
  "href": "https://api.stormpath.com/v1/accounts/ciYmtETytH0tbHRBas1D5/providerData", 
  "modifiedAt": "2014-04-01T17:00:09.189Z", 
  "providerId": "facebook"
}
</code></pre>

<h2><a id="how-to-do-integrate-stormpath-with-google"></a>How to do Integrate Stormpath with Google?</h2>

<p>After you familiarize yourself with Stormpath with one of the <a href="docs.stormpath.com">Quickstart</a> Guides, integrating Stormpath with Google requires the following steps:</p>

<ul>
<li>Creating a Social Directory for Google</li>
<li>Mapping the Directory as an Account Store to an Application</li>
<li>Accessing an Account with Google Tokens</li>
</ul>


<h3><a id="creating-a-social-directory-for-google"></a>Creating a Social Directory for Google</h3>

<p>A <code>Directory</code> is a top-level storage containers of <code>Accounts</code> in Stormpath. A <code>Directory</code> also manages security policies (like password strength) for the <code>Accounts</code> it contains.  Google Directories are a special type of <code>Directory</code> that holds Accounts for Google.</p>

<div class='docs-note'><p>Before you can create a Directory for Google, it is important that you gather information regarding your application from Google.  This information includes Client ID, Client Secret, Redirect URL and can be acquired from the developer consoles for <a href="https://console.developers.google.com/">Google</a>.</p>
</div>


<p>Creating a directory for Google require that you provide information from Google as a <code>Provider</code> <a href="http://docs.stormpath.com/rest/product-guide/#google-provider-resource">resource</a>.  This information can be use to create the directories from the <a href="https://api.stormpath.com/ui/directories/create">Console</a> or the following curl requests:</p>

<pre><code>curl -X POST --user $YOUR_API_KEY_ID:$YOUR_API_KEY_SECRET \
     -H "Accept: application/json" \
     -H "Content-Type: application/json" \
     -d '{
            "name" : "my-google-directory",
            "description" : "A Google directory",
            "provider": {
              "providerId": "google",
              "clientId":"YOUR_GOOGLE_CLIENT_ID",
              "clientSecret":"YOUR_GOOGLE_CLIENT_SECRET",
              "redirectUri":"YOUR_GOOGLE_REDIRECT_URI"
            }
          }' \
 "https://api.stormpath.com/v1/directories"
</code></pre>

<p>Response:</p>

<pre><code>HTTP/1.1 201 Created
Location: https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q
Content-Type: application/json;charset=UTF-8;

{
  "href" : "https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q",
  "name" : "my-google-directory",
  "description" : "A Google directory",
  "status" : "ENABLED",
  "tenant" : {
    "href" : "https://api.stormpath.com/v1/tenants/Gh9238fksJlsieJkPkQuW"
  },
  "accounts" : {
    "href" : "https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q/accounts"
  },
  "groups" : {
    "href" : "https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q/groups"
  },
  "provider" : {
    "href" : "https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpbCDRb2Q/provider"
  }
}
</code></pre>

<h3><a id="mapping-the-directory-as-an-account-store-to-an-application"></a>Mapping the Directory as an Account Store to an Application</h3>

<p>Once a Google <code>Directory</code> has been created, it must be mapped to an application as an <code>Account Store</code>.  When an Account Store (which can be a <code>Directory</code> or <code>Group</code>) is mapped to an <code>Application</code>, the accounts in the account store are considered the application’s users and they can login to the application.</p>

<p>Creating an Account Store Mapping can be done through the REST API, SDKs or Admin Console.</p>

<h4>Admin Console</h4>

<p>To manage Account Stores in the Console:</p>

<ol>
<li>Log in to the Stormpath Admin Console</li>
<li>Click the <em>Applications</em> tab</li>
<li>Click the Application&rsquo;s name to which you want to add an Account Store</li>
<li>Click the <em>Account Stores</em> button in the tabbar</li>
<li>Select the Google Directory that was created</li>
<li>Click <em>Add Account Store</em></li>
</ol>


<h4>REST API</h4>

<p>Request:</p>

<pre><code>curl -X POST -u $API_KEY_ID:$API_KEY_SECRET \
     -H "Content-Type: application/json;charset=UTF-8" \
     -d '{
           "application": {
             "href": "YOUR_APPLICATION_HREF"
           }
           "accountStore": {
             "href": "YOUR_GOOGLE_DIRECTORY_HREF"
           }
         }' \
     'https://api.stormpath.com/v1/accountStoreMappings'
</code></pre>

<p>Response:</p>

<pre><code>{
    "href": "https://api.stormpath.com/v1/accountStoreMappings/7Ui2gpn9tV75y3TExAmPLe",
    "accountStore": {
        "href": "https://api.stormpath.com/v1/directories/bckhcGMXQDujIXpExAmPLe"
    },
    "application": {
        "href": "https://api.stormpath.com/v1/applications/Uh8FzIouQ9C8EpcExAmPLe"
    },
    "listIndex": 0,
    "isDefaultAccountStore": false,
    "isDefaultGroupStore": false
}
</code></pre>

<h3><a id="accessing-an-account-with-google-tokens"></a>Accessing an Account with Google Tokens</h3>

<p>To access or create an account in an already created Google Directory, it is required to gather a Google Authorization Code on behalf of the user.  This requires leveraging Google&rsquo;s <a href="https://developers.google.com/accounts/docs/OAuth2">OAuth 2.0 protocol</a> and the user&rsquo;s consent for your application&rsquo;s permissions.</p>

<p>Once the Authorization Code is gathered, you can get or create the <code>Account</code> by HTTP <code>POST</code>ing to the <code>Application</code> accounts collection and specifying the <code>providerData</code>.  The <code>providerData</code> JSON object specifies the type of provider and the authorization code as follows:</p>

<pre><code>{
  "providerId": "google",
  "code": "%ACCESS_CODE_FROM_GOOGLE%"
}
</code></pre>

<p>The following is how you use <code>providerData</code> to get an <code>Account</code> for a given authorization code:</p>

<p><strong>Example Request</strong></p>

<pre><code>curl -X POST --user $YOUR_API_KEY_ID:$YOUR_API_KEY_SECRET \
     -H "Accept: application/json" \
     -H "Content-Type: application/json" \
     -d '{
            "providerData": {
              "providerId": "google",
              "code": "YOUR_GOOGLE_AUTH_CODE"
            }
          }' \
 "https://api.stormpath.com/v1/applications/YOUR_APP_ID/accounts"
</code></pre>

<p><strong>Example Response</strong></p>

<pre><code>HTTP/1.1 201 Created
Location: https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9
Content-Type: application/json;charset=UTF-8;

{
    "customData": {
        "href": "https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9/customData"
    },
    "directory": {
        "href": "https://api.stormpath.com/v1/directories/U0HJ7YcCeMpRfMcRT8ph"
    },
    "email": "testuser@gmail.com",
    "emailVerificationToken": null,
    "fullName": "Test User",
    "givenName": "Test",
    "groupMemberships": {
        "href": "https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9/groupMemberships"
    },
    "groups": {
        "href": "https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9/groups"
    },
    "href": "https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9",
    "middleName": null,
    "providerData": {
        "href": "https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9/providerData"
    },
    "status": "ENABLED",
    "surname": "User",
    "tenant": {
        "href": "https://api.stormpath.com/v1/tenants/GPpLzIzYkOO68I9i4dx"
    },
    "username": "testuser"
}
</code></pre>

<div class='docs-note'><p>The HTTP Status code when accessing an account based on a Google Authorization Code will denote if the account was created (201) or if it already existed in the Google Directory (200)</p>
</div>




<div class='docs-note'><p>To <a href="#link-expansion">expand</a> the <code>providerData</code> to get the Access Token for the Account in one HTTP request, add <code>expand=providerData</code> to the URL query parameters.</p>
</div>


<p>Once an <code>Account</code> is retrieved, Stormpath maps common fields for the Google User to the  Account.  The access token and the refresh token for any additional calls in the <code>providerData</code> resource and can be retrieved by:</p>

<pre><code>GET https://api.stormpath.com/v1/accounts/m0fw8GvxpM7n3pw6tyw9/providerData
</code></pre>

<p>The returned <code>providerData</code> will include:</p>

<pre><code>{
  "accessToken": "y29.1.AADN_Xo2hxQflWwsgCSK-WjSw1mNfZiv4", 
  "createdAt": "2014-04-01T17:00:09.154Z", 
  "href": "https://api.stormpath.com/v1/accounts/ciYmtETytH0tbHRBas1D5/providerData", 
  "modifiedAt": "2014-04-01T17:00:09.189Z", 
  "providerId": "google", 
  "refreshToken": "1/qQTS638g3ArE4U02FoiXL1yIh-OiPmhc"
}
</code></pre>

<div class='docs-note'><p>The <code>accessToken</code> can also be passed as a field for the <code>providerData</code> to access the account once it is retrieved</p>

<pre><code>POST https://api.stormpath.com/v1/applications/24mp4us71ntza6lBwlu/accounts
Content-Type: application/json;charset=UTF-8

{
  providerData: {
    "providerId": "google",
    "accessToken":"y29.1.AADN_Xo2hxQflWwsgCSK-WjSw1mNfZiv4"
  }
}
</code></pre>
</div>




<div class='docs-note'><p>The <code>refreshToken</code> will only be present if your application asked for offline access.  Review Google&#8217;s documentation for more information regarding OAuth offline access.</p>
</div>


            <div id="bottom-wrapper">
                     <div class="region region-bottom">
    <div id="block-block-1" class="block block-block first odd">

      
   Copyright © 2014 StormPath&nbsp;&nbsp;|&nbsp;&nbsp;All rights reserved 
</div><!-- /.block -->
<div id="block-menu-menu-footer-menu" class="block block-menu last even" role="navigation">

      
  <ul class="menu"><li class="first leaf"><a href="http://www.stormpath.com/privacy_policy">Privacy policy</a></li>
<li class="last leaf"><a href="http://www.stormpath.com/terms_of_service">Terms of Service</a></li>
</ul>
</div><!-- /.block -->
  </div><!-- /.region -->

            </div>          	
    	  </div>



<aside class="sidebars">
  
    <section class="region region-sidebar-first column sidebar">
      
<div id="block-stormpath-docs-languages" class="block block-stormpath-docs first odd">
 <form class="stormpath-docs-select-language" action="/docs/java/product-guide" method="post" id="stormpath-docs-language-form" accept-charset="UTF-8"><div><div class="form-item form-type-select form-item-language">
  <label for="edit-language">Language: </label>
 <select id="edit-language" name="language" class="form-select">
  
  
 	
    <option value="rest">REST API</option>
 	
    <option value="java">Java</option>
 	
    <option value="ruby">Ruby</option>
 	
    <option value="python">Python</option>
 	
    <option value="php">PHP</option>
 	
    <option value="guides" selected>Guides</option>
 	
    <option value="console">Admin Console</option>
 	
 </select>
</div>
<input type="hidden" name="form_id" value="stormpath_docs_language_form">
</div></form>
</div>

<script type="text/javascript">
	var sp_docs_menu = {};
	
		sp_docs_menu['_includes'] = [];
		
	
		sp_docs_menu['_layouts'] = [];
		
	
		sp_docs_menu['assets'] = [];
		
	
		sp_docs_menu['console'] = [];
		
			sp_docs_menu['console'].push('product-guide');
		
			sp_docs_menu['console'].push('quickstart');
		
	
		sp_docs_menu['errors'] = [];
		
			sp_docs_menu['errors'].push('2000');
		
			sp_docs_menu['errors'].push('2001');
		
			sp_docs_menu['errors'].push('2002');
		
			sp_docs_menu['errors'].push('2003');
		
			sp_docs_menu['errors'].push('2004');
		
			sp_docs_menu['errors'].push('2005');
		
			sp_docs_menu['errors'].push('2006');
		
			sp_docs_menu['errors'].push('2007');
		
			sp_docs_menu['errors'].push('2008');
		
			sp_docs_menu['errors'].push('2009');
		
			sp_docs_menu['errors'].push('2010');
		
			sp_docs_menu['errors'].push('2011');
		
			sp_docs_menu['errors'].push('2012');
		
			sp_docs_menu['errors'].push('2013');
		
			sp_docs_menu['errors'].push('2014');
		
			sp_docs_menu['errors'].push('2015');
		
			sp_docs_menu['errors'].push('2016');
		
			sp_docs_menu['errors'].push('2017');
		
			sp_docs_menu['errors'].push('2018');
		
			sp_docs_menu['errors'].push('2100');
		
			sp_docs_menu['errors'].push('2101');
		
			sp_docs_menu['errors'].push('2102');
		
			sp_docs_menu['errors'].push('2103');
		
			sp_docs_menu['errors'].push('2104');
		
			sp_docs_menu['errors'].push('2105');
		
			sp_docs_menu['errors'].push('2106');
		
			sp_docs_menu['errors'].push('2107');
		
			sp_docs_menu['errors'].push('3000');
		
			sp_docs_menu['errors'].push('3001');
		
			sp_docs_menu['errors'].push('3002');
		
			sp_docs_menu['errors'].push('3003');
		
			sp_docs_menu['errors'].push('3004');
		
			sp_docs_menu['errors'].push('4001');
		
			sp_docs_menu['errors'].push('4002');
		
			sp_docs_menu['errors'].push('5010');
		
			sp_docs_menu['errors'].push('5100');
		
			sp_docs_menu['errors'].push('5101');
		
			sp_docs_menu['errors'].push('5102');
		
			sp_docs_menu['errors'].push('5103');
		
			sp_docs_menu['errors'].push('5104');
		
			sp_docs_menu['errors'].push('5106');
		
			sp_docs_menu['errors'].push('5108');
		
			sp_docs_menu['errors'].push('5110');
		
			sp_docs_menu['errors'].push('5112');
		
			sp_docs_menu['errors'].push('5114');
		
			sp_docs_menu['errors'].push('6100');
		
			sp_docs_menu['errors'].push('6201');
		
			sp_docs_menu['errors'].push('6202');
		
			sp_docs_menu['errors'].push('7200');
		
			sp_docs_menu['errors'].push('7201');
		
			sp_docs_menu['errors'].push('7202');
		
			sp_docs_menu['errors'].push('9000');
		
			sp_docs_menu['errors'].push('9001');
		
			sp_docs_menu['errors'].push('9002');
		
			sp_docs_menu['errors'].push('9003');
		
			sp_docs_menu['errors'].push('9004');
		
			sp_docs_menu['errors'].push('9005');
		
			sp_docs_menu['errors'].push('9006');
		
	
		sp_docs_menu['guides'] = [];
		
			sp_docs_menu['guides'].push('multi-tenant');
		
			sp_docs_menu['guides'].push('social-integrations');
		
	
		sp_docs_menu['home'] = [];
		
	
		sp_docs_menu['how-do-i'] = [];
		
	
		sp_docs_menu['images'] = [];
		
	
		sp_docs_menu['integrations'] = [];
		
	
		sp_docs_menu['java'] = [];
		
			sp_docs_menu['java'].push('product-guide');
		
			sp_docs_menu['java'].push('quickstart');
		
	
		sp_docs_menu['javascripts'] = [];
		
	
		sp_docs_menu['nodejs'] = [];
		
	
		sp_docs_menu['php'] = [];
		
			sp_docs_menu['php'].push('product-guide');
		
			sp_docs_menu['php'].push('quickstart');
		
	
		sp_docs_menu['python'] = [];
		
			sp_docs_menu['python'].push('product-guide');
		
			sp_docs_menu['python'].push('quickstart');
		
	
		sp_docs_menu['rest'] = [];
		
			sp_docs_menu['rest'].push('api');
		
			sp_docs_menu['rest'].push('product-guide');
		
			sp_docs_menu['rest'].push('quickstart');
		
	
		sp_docs_menu['ruby'] = [];
		
			sp_docs_menu['ruby'].push('product-guide');
		
			sp_docs_menu['ruby'].push('quickstart');
		
	
		sp_docs_menu['sample-apps'] = [];
		
	
		sp_docs_menu['stylesheets'] = [];
		
	
</script>


<div id="block-stormpath-docs-docs-menu" class="block block-stormpath-docs last even">
  
  
        
  	
  
        
  	
  
        
  	
  
        
  	
  
        
  	
  
        
  	
  
        
  	
                
                
		<ul class="menu">
		
			<li class="leaf">
			
				<a href="/guides/multi-tenant">Multi-Tenant Applications with Stormpath</a>
			
			
			</li>
		
			<li class="leaf active-trail">
			
				<a href="/guides/social-integrations">Integrating Stormpath with Facebook and Google</a>
			
			
				<ul class="menu"><li class="leaf"><a href="#what-is-stormpath" data-level="0" class="fragment">What is Stormpath?</a><ul class="menu"></ul></li><li class="leaf"><a href="#why-should-i-use-stormpath-to-integrate-login-with-facebook-and-google" data-level="0" class="fragment">Why Should I Use Stormpath to Integrate Login with Facebook and Google?</a><ul class="menu"></ul></li><li class="leaf"><a href="#how-to-do-integrate-stormpath-with-facebook" data-level="0" class="fragment">How to do Integrate Stormpath with Facebook?</a><ul class="menu"><li class="leaf"><a href="#creating-a-social-directory-for-facebook" data-level="1" class="fragment">Creating a Social Directory for Facebook</a><ul class="menu"></ul></li><li class="leaf"><a href="#mapping-the-directory-as-an-account-store-to-an-application" data-level="1" class="fragment">Mapping the Directory as an Account Store to an Application</a><ul class="menu"></ul></li><li class="leaf"><a href="#accessing-an-account-with-facebook-tokens" data-level="1" class="fragment">Accessing an Account with Facebook Tokens</a><ul class="menu"></ul></li></ul></li><li class="leaf"><a href="#how-to-do-integrate-stormpath-with-google" data-level="0" class="fragment">How to do Integrate Stormpath with Google?</a><ul class="menu"><li class="leaf"><a href="#creating-a-social-directory-for-google" data-level="1" class="fragment">Creating a Social Directory for Google</a><ul class="menu"></ul></li><li class="leaf"><a href="#mapping-the-directory-as-an-account-store-to-an-application" data-level="1" class="fragment">Mapping the Directory as an Account Store to an Application</a><ul class="menu"></ul></li><li class="leaf"><a href="#accessing-an-account-with-google-tokens" data-level="1" class="fragment">Accessing an Account with Google Tokens</a><ul class="menu"></ul></li></ul></li></ul>
			
			</li>
		
		</ul>
  	
  
        
  	
                
                       <div class="menu-divider"></div> 
                
                
		<ul class="menu">
		
			<li class="leaf">
			
				<a href="/how-do-i">How Do I..?</a>
			
			
			</li>
		
			<li class="leaf">
			
				<a href="/errors">Stormpath Error Codes</a>
			
			
			</li>
		
		</ul>
  	
  
</div>
    </section>
  

  
</aside>


        </div>
      </div>
    </div>
  </div>
</div>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<!-- Google Code for Remarketing tag -->
<script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 1002663385;
var google_conversion_label = "wSRZCLfkjQQQ2duN3gM";
var google_custom_params = window.google_tag_params;
var google_remarketing_only = true;
/* ]]> */
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script>
<noscript>
<div style="display:inline;">
<img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1002663385/?value=0&amp;label=wSRZCLfkjQQQ2duN3gM&amp;guid=ON&amp;script=0"/>
</div>
</noscript>

<!-- AdRoll Code -->
<script type="text/javascript">
adroll_adv_id = "RVWGHIV3GJCLHIUDNFIMNY";
adroll_pix_id = "L2WE5KAWDRDBVP46PZZBQJ";
(function () {
var oldonload = window.onload;
window.onload = function(){
__adroll_loaded=true;
var scr = document.createElement("script");
var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
scr.setAttribute('async', 'true');
scr.type = "text/javascript";
scr.src = host + "/j/roundtrip.js";
((document.getElementsByTagName('head') || [null])[0] ||
document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
if(oldonload){oldonload()}};
}());
</script>

<!-- Start Visual Website Optimizer Asynchronous Code -->
<script type="text/javascript">
var _vwo_code=(function(){
var account_id=36938,
settings_tolerance=2000,
library_tolerance=1500,
use_existing_jquery=false,
// DO NOT EDIT BELOW THIS LINE
f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
</script>
<!-- End Visual Website Optimizer Asynchronous Code -->

<!-- CrazyEgg -->
<script type="text/javascript">
setTimeout(function(){var a=document.createElement("script");
var b=document.getElementsByTagName("script")[0];
a.src=document.location.protocol+"//dnn506yrbagrg.cloudfront.net/pages/scripts/0017/1602.js?"+Math.floor(new Date().getTime()/3600000);
a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
</script>

<!-- Perfect Audience -->
<script type="text/javascript">
(function() {
window._pa = window._pa || {};
// _pa.orderId = "";
// _pa.revenue = "";
var pa = document.createElement('script'); pa.type = 'text/javascript'; pa.async = true;
pa.src = ('https:' == document.location.protocol ? 'https:' : 'http:') + "//tag.perfectaudience.com/serve/51fc2c6f1b440adfcc000099.js";
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pa, s);
})();
</script>


</body>
</html>
