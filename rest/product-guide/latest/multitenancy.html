

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7. Multi-Tenancy with Stormpath &mdash; Stormpath REST API V1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="about.html"/>
    <link rel="top" title="Stormpath REST API V1 documentation" href="index.html"/>
        <link rel="next" title="8. Using ID Site" href="idsite.html"/>
        <link rel="prev" title="6. Authorization With Stormpath" href="auth_z.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Stormpath REST API
          

          
          </a>

          
            
            
              <div class="version">
                V1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">1. About Stormpath</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">2. First-Time Set-Up</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">3. Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="accnt_mgmt.html">4. Account Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth_n.html">5. Authenticating Accounts with Stormpath</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth_z.html">6. Authorization With Stormpath</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">7. Multi-Tenancy with Stormpath</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-a-multi-tenant-application">7.1. What Is a Multi-Tenant Application?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modeling-tenants-in-stormpath">7.2. Modeling Tenants in Stormpath</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#account-store-strategies-for-multi-tenancy">7.2.1. Account Store Strategies for Multi-Tenancy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#strategy-1-tenants-as-directories">Strategy 1: Tenants as Directories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#strategy-2-tenants-as-groups">Strategy 2: Tenants as Groups</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#organizations">7.2.2. Organizations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-to-create-an-organization">How to Create an Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-an-account-store-to-an-organization">Adding an Account Store to an Organization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#registering-an-organization-as-an-account-store-for-an-application">Registering an Organization as an Account Store for an Application</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#authenticating-an-account-against-an-organization">7.3. Authenticating an Account against an Organization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="idsite.html">8. Using ID Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">REST API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Stormpath REST API</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>7. Multi-Tenancy with Stormpath</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/multitenancy.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="multi-tenancy-with-stormpath">
<span id="multitenancy"></span><h1>7. Multi-Tenancy with Stormpath<a class="headerlink" href="#multi-tenancy-with-stormpath" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-a-multi-tenant-application">
<h2>7.1. What Is a Multi-Tenant Application?<a class="headerlink" href="#what-is-a-multi-tenant-application" title="Permalink to this headline">¶</a></h2>
<p>The best way to understand the concept of multi-tenancy is by thinking of a condo: lots of residents making use of a shared infrastructure while maintaining their own private and secure living areas. Similar to this, a <strong>multi-tenant application</strong> is a single application that services multiple tenants simultaneously. For privacy and security purposes, it&#8217;s very important that the application maintain data segmentation between its multiple tenants. At Stormpath, this segmentation is baked-in to our data model. How do we do this? Well, it starts with an Organization.</p>
</div>
<div class="section" id="modeling-tenants-in-stormpath">
<h2>7.2. Modeling Tenants in Stormpath<a class="headerlink" href="#modeling-tenants-in-stormpath" title="Permalink to this headline">¶</a></h2>
<p>In our <a class="reference internal" href="accnt_mgmt.html#account-mgmt"><span>Account Management</span></a> chapter we discussed two kinds of Account Stores: <a class="reference internal" href="accnt_mgmt.html#directory-mgmt"><span>Directories</span></a>, and <a class="reference internal" href="accnt_mgmt.html#group-mgmt"><span>Groups</span></a>. For multi-tenant applications there is an additional <a class="reference internal" href="reference.html#ref-organization"><span>Organization</span></a> resource, which functions like a virtual Account Store that itself wraps both Directories and Groups.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A Directory or Group can be added to multiple Organizations.</p>
</div>
<p>As with all user base modeling, we&#8217;ll begin with the basics: Directories and Groups. Then we will move on to an explanation of how the Organization resource is used when modeling multi-tenancy.</p>
<div class="section" id="account-store-strategies-for-multi-tenancy">
<span id="multitenancy-strategies"></span><h3>7.2.1. Account Store Strategies for Multi-Tenancy<a class="headerlink" href="#account-store-strategies-for-multi-tenancy" title="Permalink to this headline">¶</a></h3>
<p>Your primary consideration when modeling users in Stormpath always begins with the Directory that will contain the user Accounts. With multi-tenancy, the additional consideration is whether you will have each one of your application&#8217;s tenants represented by a Directory or a Group.</p>
<div class="section" id="strategy-1-tenants-as-directories">
<h4>Strategy 1: Tenants as Directories<a class="headerlink" href="#strategy-1-tenants-as-directories" title="Permalink to this headline">¶</a></h4>
<p>To understand the multi-tenancy considerations in modeling tenants as <a class="reference internal" href="reference.html#ref-directory"><span>Directories</span></a>, there are three characteristics of Directories that are worth remembering:</p>
<ul class="simple">
<li>All Accounts within a Directory must have a unique <code class="docutils literal"><span class="pre">email</span></code> and <code class="docutils literal"><span class="pre">username</span></code></li>
<li>All Groups within a Directory must have a unique <code class="docutils literal"><span class="pre">name</span></code></li>
<li>User policies, such as the <a class="reference internal" href="reference.html#ref-password-policy"><span>Password Policy</span></a> and the <a class="reference internal" href="reference.html#ref-accnt-creation-policy"><span>Account Creation Policy</span></a> are set at the Directory level</li>
</ul>
<p>From these points we can derive a few conditions where the tenants-as-Directories strategy is optimal. If your tenants satisfy one or more of these conditions:</p>
<ul class="simple">
<li>You do not require email uniqueness across tenants. If a user has signed up for an Account with one tenant, they are able to use that same email to create an email for another Account in another tenant.</li>
<li>Each tenant has its own password strength policy.</li>
<li>Each tenant has different emails that need to be sent (or not sent) as part of the user Account creation process.</li>
<li>Each tenant requires different user Groups and/or <a class="reference internal" href="auth_z.html#role-groups"><span>role Groups</span></a>. Application-wide Groups that span across tenants are not required.</li>
</ul>
<div class="section" id="tenants-as-directories-example">
<h5>Tenants as Directories Example<a class="headerlink" href="#tenants-as-directories-example" title="Permalink to this headline">¶</a></h5>
<p>Here is an example implementation that uses Directories to model tenants. It is important to note that this is just an example. Stormpath has a very flexible data model with intentionally versatile resources. If you&#8217;d like to discuss your particular implementation needs please <a class="reference external" href="mailto:support&#37;&#52;&#48;stormpath&#46;com">get in touch</a>!</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/ERD_TpD.png"><img alt="Tenant per Directory" src="_images/ERD_TpD.png" /></a>
<p class="caption"><span class="caption-text"><em>Tenants as Directories ERD.</em></span></p>
</div>
<p>An example implementation of the Tenants-as-Directories strategy is shown in the diagram above. Please note that everything discussed occurs inside the private data space that we refer to as your Stormpath Tenant, which is represented by the Tenant resource but does not play any part in multi-tenancy. The scenario demonstrates a multi-tenant userbase with two tenants, each of who is represented by two resources: an Organization and a Directory. There are a few points to highlight in this diagram:</p>
<ul class="simple">
<li>The ability to log into the &#8220;Lighting Banking&#8221; application is controlled by the accountStoreMappings that exist between the Application resource and the Organization resources. To enable or disable a tenant (and its userbase) from logging-in, all you would have to do is enable or disable this Account Store Mapping.</li>
<li>If Claire wanted to create another Account with Bank of B using the same email address, she would be allowed to, since email uniqueness is enforced only inside a Directory.</li>
<li>Any role Groups must be created separately, on a per-Directory basis. If you decided to create a new role, a new Group resource representing that role would have to be added to each of your tenant Directories if you wanted the Accounts in that Directory to be able to be assigned that role.</li>
<li>In order to allow System Administrators to log in to the app, you&#8217;d had to create a new Directory just for them, which is separately mapped to the Application as an Account Store. Since this Directory does not represent a tenant, no Organization resource is created.</li>
</ul>
</div>
</div>
<div class="section" id="strategy-2-tenants-as-groups">
<h4>Strategy 2: Tenants as Groups<a class="headerlink" href="#strategy-2-tenants-as-groups" title="Permalink to this headline">¶</a></h4>
<p>The other multi-tenancy option is to have a single Directory under which each of your application&#8217;s tenants has their own Group. Choosing this strategy is likely right for you if:</p>
<ul class="simple">
<li>You want to guarantee <code class="docutils literal"><span class="pre">email</span></code> and <code class="docutils literal"><span class="pre">username</span></code> uniqueness across all tenants. This allows for a unified user identity, which allows for things like single-sign-on and account sharing between tenants on your application.</li>
<li>All tenants share password and email policies.</li>
<li>You want to ensure that tenant names are unique, since the Group <code class="docutils literal"><span class="pre">name</span></code> must be unique within a Directory.</li>
<li>You want to have application-wide roles that span across tenants.</li>
</ul>
<div class="section" id="tenants-as-groups-example">
<h5>Tenants as Groups Example<a class="headerlink" href="#tenants-as-groups-example" title="Permalink to this headline">¶</a></h5>
<p>Below we have an example of an implementation that uses Groups to model tenants. This shows just one possible scenario, and if you&#8217;d like to discuss your particular implementation needs please <a class="reference external" href="mailto:support&#37;&#52;&#48;stormpath&#46;com">get in touch</a>!</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="_images/ERD_TpG.png"><img alt="Tenant per Group" src="_images/ERD_TpG.png" /></a>
<p class="caption"><span class="caption-text"><em>Tenants as Groups ERD</em></span></p>
</div>
<p>Once again, everything here is happening inside your private Stormpath Tenant. Just as with the Tenants-as-Directories strategy, every Tenant is modeled by its own dedicated Organization, but in this case there is also one Group resource per Tenant. All of the Accounts and Groups are contained within a single Directory resource. This all means that:</p>
<ul class="simple">
<li>You can still control access to the Application by enabling or disabling the accountStoreMappings between the Organizations and the Application resource.</li>
<li>If Claire tried to create another Account with Bank of B using the same email address she&#8217;d used with Bank of A, she would be unable to, since emails must be unique within a Directory.</li>
<li>If there were a role Group that you wanted to be shared among the tenants, it is as simple as creating one instance of it and then associating Accounts with it.</li>
<li>System Administrators just need their own Role Group, which is then mapped as an Account Store with the Application.</li>
<li>Claire and Esther do not have access to your application&#8217;s Admin Console, because that is only allowed for members of the &#8220;Sys Admins&#8221; role Group. If, however, Claire were hired as a System Administrator, then she could be easily added to the &#8220;Sys Admins&#8221; Group and inherit all of its permissions.</li>
</ul>
</div>
<div class="section" id="naming-your-tenant-groups">
<h5>Naming Your Tenant Groups<a class="headerlink" href="#naming-your-tenant-groups" title="Permalink to this headline">¶</a></h5>
<p>As this is the most common strategy used by our customers, we have found some minor naming conventions that are very powerful and we consider to be best-practice.</p>
<p>First of all, the name of your tenant Organization will have a unique <code class="docutils literal"><span class="pre">nameKey</span></code>, for example <code class="docutils literal"><span class="pre">BankOfA</span></code>. This <code class="docutils literal"><span class="pre">nameKey</span></code> this can be used for organizing tenant Groups and sub-Groups.</p>
<p>For example, if your Organization&#8217;s <code class="docutils literal"><span class="pre">nameKey</span></code> is <code class="docutils literal"><span class="pre">BankOfA</span></code>, you could name the Group <code class="docutils literal"><span class="pre">BankOfA.tenant</span></code>. If you want to create sub-Groups for roles like <code class="docutils literal"><span class="pre">users</span></code> and <code class="docutils literal"><span class="pre">admins</span></code>, we recommend that you prepend the <code class="docutils literal"><span class="pre">nameKey</span></code> to their <code class="docutils literal"><span class="pre">name</span></code> Attribute, along with a descriptive name of what kind of Group it is:</p>
<p><code class="docutils literal"><span class="pre">BankOfA.role.users</span></code></p>
<p><code class="docutils literal"><span class="pre">BankOfA.role.administrators</span></code></p>
<p>This has two benefits:</p>
<ol class="arabic simple">
<li>It makes it easy to find all the role Groups for that particular tenant, since you can simply search for the nameKey in the <code class="docutils literal"><span class="pre">name</span></code> field:</li>
</ol>
<blockquote>
<div><code class="docutils literal"><span class="pre">GET</span> <span class="pre">https://api.stormpath.com/v1/directories/29E0XzabMwPGluegBqAl0Y/groups?name=BankOfA.role.*</span></code></div></blockquote>
<p>Or, if you wanted to retrieve the tenant Group and all of its sub-Groups, make the query a little less restrictive by removing the &#8220;role&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>GET https://api.stormpath.com/v1/directories/29E0XzabMwPGluegBqAl0Y/groups?name=BankOfA.*
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>It ensures that no tenant sub-Groups have name collisions between tenants.</li>
</ol>
</div>
</div>
</div>
<div class="section" id="organizations">
<h3>7.2.2. Organizations<a class="headerlink" href="#organizations" title="Permalink to this headline">¶</a></h3>
<p>Once you have your application&#8217;s tenants modeled as Directories or Groups, the final tool that Stormpath gives you is the Organization resource. These are umbrella entities that allow you to better structure and control multi-tenant applications.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="reference.html#ref-organization"><span>Organization</span></a> resource is not to be confused with the Tenant resource. While the <a class="reference internal" href="reference.html#ref-tenant"><span>Tenant</span></a> resource is so-called because it represents your tenancy inside the Stormpath server, the Organization resource represents the space alloted for a tenant of your application.</p>
</div>
<p>The Organization resource allows your application&#8217;s tenants to have as many, or as few, Directories and Groups as they want, while also maintaining strict data segregation. So if a tenant requires a Cloud Directory, a Google Social Directory, and an LDAP Directory, all of these can sit under the umbrella of a single Organization resource that represents their data space in your app.</p>
<p>Although Organizations do not themselves own Accounts in the same way as Directories and Groups, they can be mapped to Applications as Account Stores for the purposes of user log in. This means that they can be used as single-point for access control to an Application. So, if you wanted to enable login for a new tenant in your multi-tenant application, all you would have to do is map all of the relevant Directories and/or Groups to your Organization, and then map that Organization to your Application as an Account Store. If at some future point you want to disable that tenant, all you have to do is remove the Account Store Mapping between that Organization and your Application, and the tenant&#8217;s users would no longer be able to log in.</p>
<div class="section" id="how-to-create-an-organization">
<h4>How to Create an Organization<a class="headerlink" href="#how-to-create-an-organization" title="Permalink to this headline">¶</a></h4>
<p>You can create an Organization in Stormpath by simply performing an HTTP POST to the <code class="docutils literal"><span class="pre">/v1/organizations</span></code> endpoint.</p>
<p>So, if for example one of our application&#8217;s tenants was the Bank of A, we could send the following POST:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/organizations</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bank of A&quot;</span><span class="p">,</span>
  <span class="nt">&quot;nameKey&quot;</span><span class="p">:</span> <span class="s2">&quot;BankOfA&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Which would return the following:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE&quot;</span><span class="p">,</span>
  <span class="nt">&quot;createdAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-10-02T15:27:01.658Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;modifiedAt&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-10-02T15:27:01.658Z&quot;</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Bank of A&quot;</span><span class="p">,</span>
  <span class="nt">&quot;nameKey&quot;</span><span class="p">:</span> <span class="s2">&quot;BankOfA&quot;</span><span class="p">,</span>
  <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;customData&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE/customData&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;defaultAccountStoreMapping&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;defaultGroupStoreMapping&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nt">&quot;accountStoreMappings&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE/accountStoreMappings&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;groups&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE/groups&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accounts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE/accounts&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;tenant&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/tenants/1gBTncWsp2ObQGgexAMPLE&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notice here that both the Default Account Store and Group Store are <code class="docutils literal"><span class="pre">null</span></code> which means that Groups and Accounts added to the Organization (e.g. A POST to <code class="docutils literal"><span class="pre">/v1/organizations/$ORGANIZATION_ID/groups</span></code>) would fail until a default Account Store is added.</p>
</div>
<div class="section" id="adding-an-account-store-to-an-organization">
<h4>Adding an Account Store to an Organization<a class="headerlink" href="#adding-an-account-store-to-an-organization" title="Permalink to this headline">¶</a></h4>
<p>Like other Account Stores, an Organization can be mapped to an Application so that users in the Organization can log-in to that application (for more about how logging-in works with Stormpath, please see <a class="reference internal" href="auth_n.html#authn"><span>the Authentication chapter</span></a>). But before you do this, you must first associate some users with the Organization so that there is someone to log in! To do this, you have to map some Account Stores to your Organization.</p>
<p>First, you will need the <code class="docutils literal"><span class="pre">href</span></code> value for a Directory or Group. This, combined with the <code class="docutils literal"><span class="pre">href</span></code> of the Organization will be sent in a POST:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/organizations</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;organization&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accountStore&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/groups/2SKhstu8Plaekcaexample&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These two attributes, <code class="docutils literal"><span class="pre">organization</span></code> and <code class="docutils literal"><span class="pre">accountStore</span></code> are required, though you may add some optional attributes as well:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">listIndex</span></code>: Represents the priority in which this accountStore will be consulted by the Organization during an authentication attempt. This is a zero-based index, meaning that an Account Store at <code class="docutils literal"><span class="pre">listIndex</span></code> of 0 will be consulted first, followed by the Account Store at listIndex 1, etc. Setting a negative value will default the value to 0, placing it first in the list. A listIndex of larger than the current list size will place the mapping at the end of the list and then default the value to (list size – 1).</li>
<li><code class="docutils literal"><span class="pre">isDefaultAccountStore</span></code>: A <code class="docutils literal"><span class="pre">true</span></code> value indicates that new Accounts created by the Organization’s <code class="docutils literal"><span class="pre">/accounts</span></code> endpoint will be automatically saved to this mapping’s Directory or Group.</li>
<li><code class="docutils literal"><span class="pre">isDefaultGroupStore</span></code>: A <code class="docutils literal"><span class="pre">true</span></code> value indicates that new Groups created by the Organization’s <code class="docutils literal"><span class="pre">/groups</span></code> endpoint will be automatically saved to this mapping’s Directory. Note that a <code class="docutils literal"><span class="pre">true</span></code> value will only be valid here if the accountStore is a Directory.</li>
</ul>
<p>In order to be able to add Groups and Accounts to the Organization in the way mentioned above, we should also make sure that we mark this Account Store as our default for both Accounts and Groups:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/v1/organizations</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">api.stormpath.com</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;organization&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accountStore&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/groups/2SKhstu8Plaekcaexample&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;isDefaultAccountStore&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;isDefaultGroupStore&quot;</span><span class="p">:</span><span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Which would result in the following <code class="docutils literal"><span class="pre">201</span> <span class="pre">Created</span></code> response:</p>
<div class="highlight-http"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">201</span> <span class="ne">Created</span>
<span class="na">Location</span><span class="o">:</span> <span class="l">https://api.stormpath.com/v1/organizationAccountStoreMappings/3e9cNxhX8abxmPWexAMPle&quot;</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json;charset=UTF-8</span>

<span class="p">{</span>
  <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizationAccountStoreMappings/3e9cNxhX8abxmPWexAMPle&quot;</span><span class="p">,</span>
  <span class="nt">&quot;listIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;isDefaultAccountStore&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;isDefaultGroupStore&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nt">&quot;organization&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/organizations/DhfD17pJrUbsofEXaMPLE&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;accountStore&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;href&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.stormpath.com/v1/groups/2SKhstu8Plaekcaexample&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>So our Organization now has an associated Directory which can be used as an Account Store to add new Accounts and Groups. To enable login for the Accounts in this Organization, we must now map the Organization to an Application.</p>
</div>
<div class="section" id="registering-an-organization-as-an-account-store-for-an-application">
<h4>Registering an Organization as an Account Store for an Application<a class="headerlink" href="#registering-an-organization-as-an-account-store-for-an-application" title="Permalink to this headline">¶</a></h4>
<p>As described in <a class="reference internal" href="auth_n.html#authn"><span>the Authentication chapter</span></a>, in order to allow users to log-in to an Application, you must map some kind of Account Store (e.g. a Group or Directory) to it. One approach is to go one-by-one and map each Directory and/or Group to the Application. However, since we are building a multi-tenant app, and the Organization is itself an Account Store, we can just map our Organization resource to our Application resource. This would enable login for all of the Directories and Groups currently inside that Organization, as well as any we add in the future.</p>
<p>To map an Organization to an Application, simply follow the steps you would for any Account Store, as described in <a class="reference internal" href="auth_n.html#create-asm"><span>Mapping a new Account Store</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="authenticating-an-account-against-an-organization">
<h2>7.3. Authenticating an Account against an Organization<a class="headerlink" href="#authenticating-an-account-against-an-organization" title="Permalink to this headline">¶</a></h2>
<p>Authenticating an Account against an Organization works essentially the same way as described in <a class="reference internal" href="auth_n.html#how-login-works"><span>5.1.2. How Login Attempts Work in Stormpath</span></a>. The only difference is that adding the Organization resource allows for an additional level of Account Stores.</p>
<p>When a login attempt is made against an Application’s <code class="docutils literal"><span class="pre">/loginAttempts</span></code> endpoint without specifying an Account Store, Stormpath will iterate through the index of Account Stores mapped to the Application, in priority order. For every Account Store entry:</p>
<ul class="simple">
<li>If it is a Directory or Group, attempt to log in on that resource.</li>
<li>If it is an Organization:<ul>
<li>Iterate through the index of Account Stores mapped to the Organization, in priority order. For every Account Store entry:<ul>
<li>If it is a Directory or Group, attempt to log in on that resource.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>If the login attempt does specify an Organization, then we simply jump to that point in the steps, and the Organization&#8217;s Account Stores are iterated through as described above.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="idsite.html" class="btn btn-neutral float-right" title="8. Using ID Site" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="auth_z.html" class="btn btn-neutral" title="6. Authorization With Stormpath" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Stormpath, Inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'V1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>